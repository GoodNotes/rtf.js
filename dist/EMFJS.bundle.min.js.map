{"version":3,"sources":["webpack://rtfjs/webpack/universalModuleDefinition","webpack://rtfjs/webpack/bootstrap","webpack://rtfjs/./src/emfjs/index.ts","webpack://rtfjs/./src/emfjs/Renderer.ts","webpack://rtfjs/./src/util/index.ts","webpack://rtfjs/./src/util/SVG.ts","webpack://rtfjs/./src/emfjs/Blob.ts","webpack://rtfjs/./src/emfjs/Helper.ts","webpack://rtfjs/./src/emfjs/EMFRecords.ts","webpack://rtfjs/./src/emfjs/Primitives.ts","webpack://rtfjs/./src/emfjs/Region.ts","webpack://rtfjs/./src/emfjs/Style.ts","webpack://rtfjs/./src/emfjs/Bitmap.ts","webpack://rtfjs/./src/emfjs/GDIContext.ts"],"names":["root","factory","exports","module","define","amd","this","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","blob","parse","log","render","info","svgElement","document","createElementNS","_render","mapMode","wExt","hExt","xExt","yExt","setAttribute","join","width","height","_img","reader","readUint32","size","EMF","svg","w","h","gdi","setWindowExtEx","setViewportExtEx","setMapMode","hdrsize","_hdrsize","_records","play","flood","filter","resultId","color","opacity","_settings","floodElement","toString","appendChild","composite","in1","in2","k1","k2","k3","k4","compositeElement","_path","move","x","y","path","substr","line","pts","forEach","point","curveC","x1","y1","x2","y2","close","filters","SVGFilters","_defs","undefined","_svg","parent","settings","_appendSettings","image","url","imageElement","setAttributeNS","rect","rx","ry","rectElement","Number","lineElement","polygon","points","polygonElement","map","polyline","polylineElement","ellipse","cx","cy","ellipseElement","builder","pathElement","text","textElement","textNode","createTextNode","id","filterElement","pattern","patternElement","defs","defsElement","clipPath","units","clipElement","createPath","SVGPathBuilder","element","keys","offset","Blob","data","pos","Uint8Array","eof","length","seek","newpos","skip","cnt","newPos","readBinary","ret","String","fromCharCode","readInt8","readUint8","readInt32","val","readUint16","readInt16","readString","readNullTermString","maxSize","byte","readFixedSizeUnicodeString","fixedSizeChars","charCode","message","setPrototypeOf","Error","isLoggingEnabled","loggingEnabled","enabled","console","_makeUniqueId","prefix","_uniqueId","_writeUint32Val","uint8arr","_blobToBinary","len","GDI","FormatSignature","ENHMETA_SIGNATURE","EPS_SIGNATURE","BITMAPINFOHEADER_SIZE","BITMAPCOREHEADER_SIZE","RecordType","EMR_POLYBEZIER","EMR_POLYGON","EMR_POLYLINE","EMR_POLYBEZIERTO","EMR_POLYLINETO","EMR_POLYPOLYLINE","EMR_POLYPOLYGON","EMR_SETWINDOWEXTEX","EMR_SETWINDOWORGEX","EMR_SETVIEWPORTEXTEX","EMR_SETVIEWPORTORGEX","EMR_SETBRUSHORGEX","EMR_EOF","EMR_SETPIXELV","EMR_SETMAPPERFLAGS","EMR_SETMAPMODE","EMR_SETBKMODE","EMR_SETPOLYFILLMODE","EMR_SETROP2","EMR_SETSTRETCHBLTMODE","EMR_SETTEXTALIGN","EMR_SETCOLORADJUSTMENT","EMR_SETTEXTCOLOR","EMR_SETBKCOLOR","EMR_OFFSETCLIPRGN","EMR_MOVETOEX","EMR_SETMETARGN","EMR_EXCLUDECLIPRECT","EMR_INTERSECTCLIPRECT","EMR_SCALEVIEWPORTEXTEX","EMR_SCALEWINDOWEXTEX","EMR_SAVEDC","EMR_RESTOREDC","EMR_SETWORLDTRANSFORM","EMR_MODIFYWORLDTRANSFORM","EMR_SELECTOBJECT","EMR_CREATEPEN","EMR_CREATEBRUSHINDIRECT","EMR_DELETEOBJECT","EMR_ANGLEARC","EMR_ELLIPSE","EMR_RECTANGLE","EMR_ROUNDRECT","EMR_ARC","EMR_CHORD","EMR_PIE","EMR_SELECTPALETTE","EMR_CREATEPALETTE","EMR_SETPALETTEENTRIES","EMR_RESIZEPALETTE","EMR_REALIZEPALETTE","EMR_EXTFLOODFILL","EMR_LINETO","EMR_ARCTO","EMR_POLYDRAW","EMR_SETARCDIRECTION","EMR_SETMITERLIMIT","EMR_BEGINPATH","EMR_ENDPATH","EMR_CLOSEFIGURE","EMR_FILLPATH","EMR_STROKEANDFILLPATH","EMR_STROKEPATH","EMR_FLATTENPATH","EMR_WIDENPATH","EMR_SELECTCLIPPATH","EMR_ABORTPATH","EMR_COMMENT","EMR_FILLRGN","EMR_FRAMERGN","EMR_INVERTRGN","EMR_PAINTRGN","EMR_EXTSELECTCLIPRGN","EMR_BITBLT","EMR_STRETCHBLT","EMR_MASKBLT","EMR_PLGBLT","EMR_SETDIBITSTODEVICE","EMR_STRETCHDIBITS","EMR_EXTCREATEFONTINDIRECTW","EMR_EXTTEXTOUTA","EMR_EXTTEXTOUTW","EMR_POLYBEZIER16","EMR_POLYGON16","EMR_POLYLINE16","EMR_POLYBEZIERTO16","EMR_POLYLINETO16","EMR_POLYPOLYLINE16","EMR_POLYPOLYGON16","EMR_POLYDRAW16","EMR_CREATEMONOBRUSH","EMR_CREATEDIBPATTERNBRUSHPT","EMR_EXTCREATEPEN","EMR_POLYTEXTOUTA","EMR_POLYTEXTOUTW","EMR_SETICMMODE","EMR_CREATECOLORSPACE","EMR_SETCOLORSPACE","EMR_DELETECOLORSPACE","EMR_GLSRECORD","EMR_GLSBOUNDEDRECORD","EMR_PIXELFORMAT","EMR_DRAWESCAPE","EMR_EXTESCAPE","EMR_SMALLTEXTOUT","EMR_FORCEUFIMAPPING","EMR_NAMEDESCAPE","EMR_COLORCORRECTPALETTE","EMR_SETICMPROFILEA","EMR_SETICMPROFILEW","EMR_ALPHABLEND","EMR_SETLAYOUT","EMR_TRANSPARENTBLT","EMR_GRADIENTFILL","EMR_SETLINKEDUFIS","EMR_SETTEXTJUSTIFICATION","EMR_COLORMATCHTOTARGETW","EMR_CREATECOLORSPACEW","MetafileEscapes","NEWFRAME","ABORTDOC","NEXTBAND","SETCOLORTABLE","GETCOLORTABLE","FLUSHOUT","DRAFTMODE","QUERYESCSUPPORT","SETABORTPROC","STARTDOC","ENDDOC","GETPHYSPAGESIZE","GETPRINTINGOFFSET","GETSCALINGFACTOR","META_ESCAPE_ENHANCED_METAFILE","SETPENWIDTH","SETCOPYCOUNT","SETPAPERSOURCE","PASSTHROUGH","GETTECHNOLOGY","SETLINECAP","SETLINEJOIN","SETMITERLIMIT","BANDINFO","DRAWPATTERNRECT","GETVECTORPENSIZE","GETVECTORBRUSHSIZE","ENABLEDUPLEX","GETSETPAPERBINS","GETSETPRINTORIENT","ENUMPAPERBINS","SETDIBSCALING","EPSPRINTING","ENUMPAPERMETRICS","GETSETPAPERMETRICS","POSTSCRIPT_DATA","POSTSCRIPT_IGNORE","GETDEVICEUNITS","GETEXTENDEDTEXTMETRICS","GETPAIRKERNTABLE","EXTTEXTOUT","GETFACENAME","DOWNLOADFACE","METAFILE_DRIVER","QUERYDIBSUPPORT","BEGIN_PATH","CLIP_TO_PATH","END_PATH","OPEN_CHANNEL","DOWNLOADHEADER","CLOSE_CHANNEL","POSTSCRIPT_PASSTHROUGH","ENCAPSULATED_POSTSCRIPT","POSTSCRIPT_IDENTIFY","POSTSCRIPT_INJECTION","CHECKJPEGFORMAT","CHECKPNGFORMAT","GET_PS_FEATURESETTING","MXDC_ESCAPE","SPCLPASSTHROUGH2","MapMode","MM_TEXT","MM_LOMETRIC","MM_HIMETRIC","MM_LOENGLISH","MM_HIENGLISH","MM_TWIPS","MM_ISOTROPIC","MM_ANISOTROPIC","StretchMode","BLACKONWHITE","WHITEONBLACK","COLORONCOLOR","HALFTONE","MixMode","TRANSPARENT","OPAQUE","BrushStyle","BS_SOLID","BS_NULL","BS_HATCHED","BS_PATTERN","BS_INDEXED","BS_DIBPATTERN","BS_DIBPATTERNPT","BS_PATTERN8X8","BS_DIBPATTERN8X8","BS_MONOPATTERN","PenStyle","PS_COSMETIC","PS_ENDCAP_ROUND","PS_JOIN_ROUND","PS_SOLID","PS_DASH","PS_DOT","PS_DASHDOT","PS_DASHDOTDOT","PS_NULL","PS_INSIDEFRAME","PS_USERSTYLE","PS_ALTERNATE","PS_ENDCAP_SQUARE","PS_ENDCAP_FLAT","PS_JOIN_BEVEL","PS_JOIN_MITER","PS_GEOMETRIC","PolygonFillMode","ALTERNATE","WINDING","BitmapCompression","BI_RGB","BI_RLE8","BI_RLE4","BI_BITFIELDS","BI_JPEG","BI_PNG","RegionMode","RGN_AND","RGN_OR","RGN_XOR","RGN_DIFF","RGN_COPY","StockObject","WHITE_BRUSH","LTGRAY_BRUSH","GRAY_BRUSH","DKGRAY_BRUSH","BLACK_BRUSH","NULL_BRUSH","WHITE_PEN","BLACK_PEN","NULL_PEN","OEM_FIXED_FONT","ANSI_FIXED_FONT","ANSI_VAR_FONT","SYSTEM_FONT","DEVICE_DEFAULT_FONT","DEFAULT_PALETTE","SYSTEM_FIXED_FONT","DEFAULT_GUI_FONT","DC_BRUSH","DC_PEN","headerSize","recordStart","bounds","frame","descriptionLen","descriptionOff","nPalEntries","refDevCx","refDevCy","refDevCxMm","refDevCyMm","hdrSize","prevPos","description","pixelFormatSize","pixelFormatOff","displayDevCxUm","displayDevCyUm","first","_header","EmfHeader","all","curpos","type","push","setWindowOrgEx","setViewportOrgEx","saveDC","restoreDC","setBkMode","setBkColor","createBrush","createPen","offBmi","cbBmi","offBits","cbBits","header","off","selectObject","deleteObject","rectangle","lineTo","moveToEx","isSmall","polyCnt","polygonsPtCnts","ptCnt","ip","polyPolygon","setPolyFillMode","polybezier","start","setTextAlign","setStretchBltMode","setBrushOrgEx","beginPath","endPath","abortPath","closeFigure","fillPath","strokePath","selectClipPath","selectClipRgn","offsetClipRgn","setMiterLimit","recordName","main_loop","clone","PointS","PointL","left","top","right","bottom","RectL","empty","intersect","rectL","Math","max","min","SizeL","copy","rectCnt","scans","scanLine","Scan","append","_updateComplexity","complexity","Region","scan","scanlines","scanline","subtract","si","cloned","splice","last","slen","offX","offY","CreateSimpleRegion","rgn","g","b","ColorRef","toHex","slice","escapement","orientation","weight","italic","underline","strikeout","charset","outprecision","clipprecision","quality","pitchAndFamily","pitch","family","dataLength","facename","Font","JSON","stringify","style","dibpatternpt","hatchstyle","Brush","brush","Pen","skipsize","planes","bitcount","colors","compression","sizeimage","xpelspermeter","ypelspermeter","clrused","clrimportant","usergb","_usergb","_infosize","BitmapCoreHeader","BitmapInfoHeader","masks","getWidth","getHeight","abs","infosize","bitmapInfo","_reader","_offset","_location","_info","BitmapInfo","totalSize","makeBitmapFileHeader","buf","ArrayBuffer","view","base64ref","prevpos","mime","ref","btoa","svgPath","Path","_StockObjects","createSolidBrush","createSolidPen","stockObjs","objs","createStockObjects","defObjects","_svggroup","_svgclipChanged","_svgtextbkfilter","mapmode","stretchmode","textalign","bkmode","textcolor","bkcolor","polyfillmode","miterlimit","wx","wy","ww","wh","vx","vy","vw","vh","nextbrx","nextbry","brx","bry","clip","ownclip","selected","defObj","_svgdefs","_svgPatterns","_svgClipPaths","_svgPath","pen","font","palette","region","state","GDIContextState","statestack","objects","origin","prevstate","saved","pop","stretchMode","rw","rh","_todevY","_todevX","_todevH","_pushGroup","opts","_applyOpts","toX","toY","fromX","fromY","polygons","isLineTo","firstPts","firstPt","unshift","lastPt","isPolyBezierTo","cp1","cp2","ep","rgnMode","_getClipRgn","textAlignmentMode","miterLimit","bkMode","bkColor","polyFillMode","index","idx","_storeObject","createPenEx","objIdx","checkType","obj","_getObject","_selectObject","selPath","fill","_deleteObject","viewBox","preserveAspectRatio","_getSvgClipPathForRegion","_getStockObject","_getSvgDef","existingId","sclip","_todevW","j","_getSvgPatternForBrush","img","spat","patternUnits","floor","_tologicalX","_tologicalY","_tologicalW","_tologicalH","usePen","useBrush","useFont","stroke","dotWidth","dashWidth","dotSpacing"],"mappings":"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","file":"EMFJS.bundle.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"EMFJS\"] = factory();\n\telse\n\t\troot[\"EMFJS\"] = factory();\n})(this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2016 Tom Zoehner\r\nCopyright (c) 2018 Thomas Bluemel\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nexport { Renderer, IRendererSettings } from \"./Renderer\";\r\nexport { EMFJSError as Error, loggingEnabled } from \"./Helper\";\r\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2016 Tom Zoehner\r\nCopyright (c) 2018 Thomas Bluemel\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nimport { SVG } from \"../util\";\r\nimport { Blob } from \"./Blob\";\r\nimport { EMFRecords } from \"./EMFRecords\";\r\nimport { GDIContext } from \"./GDIContext\";\r\nimport { EMFJSError, Helper } from \"./Helper\";\r\n\r\nexport interface IRendererSettings {\r\n    width: string;\r\n    height: string;\r\n    wExt: number;\r\n    hExt: number;\r\n    xExt: number;\r\n    yExt: number;\r\n    mapMode: number;\r\n}\r\n\r\nexport class Renderer {\r\n    private _img: EMF;\r\n\r\n    constructor(blob: ArrayBuffer) {\r\n        this.parse(blob);\r\n        Helper.log(\"EMFJS.Renderer instantiated\");\r\n    }\r\n\r\n    public render(info: IRendererSettings): SVGElement {\r\n        const svgElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n\r\n        this._render(\r\n            new SVG(svgElement),\r\n            info.mapMode,\r\n            info.wExt,\r\n            info.hExt,\r\n            info.xExt,\r\n            info.yExt);\r\n        svgElement.setAttribute(\"viewBox\", [0, 0, info.xExt, info.yExt].join(\" \"));\r\n        svgElement.setAttribute(\"preserveAspectRatio\", \"none\"); // TODO: MM_ISOTROPIC vs MM_ANISOTROPIC\r\n        svgElement.setAttribute(\"width\", info.width);\r\n        svgElement.setAttribute(\"height\", info.height);\r\n        return svgElement;\r\n    }\r\n\r\n    private parse(blob: ArrayBuffer) {\r\n        this._img = null;\r\n\r\n        const reader = new Blob(blob);\r\n\r\n        const type = reader.readUint32();\r\n        if (type !== 0x00000001) {\r\n            throw new EMFJSError(\"Not an EMF file\");\r\n        }\r\n        const size = reader.readUint32();\r\n        if (size % 4 !== 0) {\r\n            throw new EMFJSError(\"Not an EMF file\");\r\n        }\r\n\r\n        this._img = new EMF(reader, size);\r\n\r\n        if (this._img == null) {\r\n            throw new EMFJSError(\"Format not recognized\");\r\n        }\r\n    }\r\n\r\n    private _render(svg: SVG, mapMode: number, w: number, h: number, xExt: number, yExt: number) {\r\n        const gdi = new GDIContext(svg);\r\n        gdi.setWindowExtEx(w, h);\r\n        gdi.setViewportExtEx(xExt, yExt);\r\n        gdi.setMapMode(mapMode);\r\n        Helper.log(\"[EMF] BEGIN RENDERING --->\");\r\n        this._img.render(gdi);\r\n        Helper.log(\"[EMF] <--- DONE RENDERING\");\r\n    }\r\n}\r\n\r\nclass EMF {\r\n    private _hdrsize: number;\r\n    private _records: EMFRecords;\r\n\r\n    constructor(reader: Blob, hdrsize: number) {\r\n        this._hdrsize = hdrsize;\r\n        this._records = new EMFRecords(reader, this._hdrsize);\r\n    }\r\n\r\n    public render(gdi: GDIContext): void {\r\n        this._records.play(gdi);\r\n    }\r\n}\r\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2020 Tom Zoehner\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nexport { SVG } from \"./SVG\";\r\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2020 Ynse Hoornenborg\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nexport class SVGFilters {\r\n\r\n    public flood(filter: SVGFilterElement, resultId: string, color: string, opacity: number, _settings?: any): void {\r\n        const floodElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feFlood\");\r\n        if (resultId) {\r\n            floodElement.setAttribute(\"id\", resultId);\r\n        }\r\n        floodElement.setAttribute(\"flood-color\", color);\r\n        floodElement.setAttribute(\"flood-opacity\", opacity.toString());\r\n        filter.appendChild(floodElement);\r\n    }\r\n\r\n    public composite(filter: SVGFilterElement,\r\n                     resultId: string,\r\n                     in1: string,\r\n                     in2: string,\r\n                     k1?: number,\r\n                     k2?: number,\r\n                     k3?: number,\r\n                     k4?: number,\r\n                     _settings?: any): void {\r\n        const compositeElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feComposite\");\r\n        if (resultId) {\r\n            compositeElement.setAttribute(\"id\", resultId);\r\n        }\r\n        compositeElement.setAttribute(\"in\", in1);\r\n        compositeElement.setAttribute(\"in2\", in2);\r\n        filter.appendChild(compositeElement);\r\n    }\r\n}\r\n\r\nexport class SVGPathBuilder {\r\n    private _path = \"\";\r\n\r\n    public move(x: number, y: number): void {\r\n        this._path += ` M ${x} ${y}`;\r\n    }\r\n\r\n    public path(): string {\r\n        return this._path.substr(1);\r\n    }\r\n\r\n    public line(pts: number[][]): void {\r\n        pts.forEach((point) => {\r\n            this._path += ` L ${point[0]} ${point[1]}`;\r\n        });\r\n    }\r\n\r\n    public curveC(x1: number, y1: number, x2: number, y2: number, x: number, y: number): void {\r\n        this._path += ` C ${x1} ${y1}, ${x2} ${y2}, ${x} ${y}`;\r\n    }\r\n\r\n    public close(): void {\r\n        this._path += ` Z`;\r\n    }\r\n}\r\n\r\nexport class SVG {\r\n    public filters = new SVGFilters();\r\n    private _svg: SVGElement;\r\n    private _defs: SVGDefsElement | undefined = undefined;\r\n\r\n    constructor(svg: SVGElement) {\r\n        this._svg = svg;\r\n    }\r\n\r\n    public svg(parent: Element,\r\n               x: number,\r\n               y: number,\r\n               width: number,\r\n               height: number,\r\n               settings?: any): SVGElement {\r\n        const svgElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n        svgElement.setAttribute(\"x\", x.toString());\r\n        svgElement.setAttribute(\"y\", y.toString());\r\n        svgElement.setAttribute(\"width\", width.toString());\r\n        svgElement.setAttribute(\"height\", height.toString());\r\n        this._appendSettings(settings, svgElement);\r\n\r\n        if (parent != null) {\r\n            parent.appendChild(svgElement);\r\n        } else {\r\n            this._svg.appendChild(svgElement);\r\n        }\r\n\r\n        return svgElement;\r\n    }\r\n\r\n    public image(parent: Element,\r\n                 x: number,\r\n                 y: number,\r\n                 width: number,\r\n                 height: number,\r\n                 url: string,\r\n                 settings?: any): SVGImageElement {\r\n        const imageElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\r\n        imageElement.setAttribute(\"x\", x.toString());\r\n        imageElement.setAttribute(\"y\", y.toString());\r\n        imageElement.setAttribute(\"width\", width.toString());\r\n        imageElement.setAttribute(\"height\", height.toString());\r\n        imageElement.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\", url);\r\n        this._appendSettings(settings, imageElement);\r\n        parent.appendChild(imageElement);\r\n        return imageElement;\r\n    }\r\n\r\n    public rect(parent: Element,\r\n                x: number,\r\n                y: number,\r\n                width: number,\r\n                height: number,\r\n                rx?: number,\r\n                ry?: number,\r\n                settings?: any): SVGRectElement;\r\n    public rect(parent: Element, x: number, y: number, width: number, height: number, settings?: any): SVGRectElement;\r\n    public rect(parent: Element,\r\n                x: number,\r\n                y: number,\r\n                width: number,\r\n                height: number,\r\n                rx?: number | any,\r\n                ry?: number,\r\n                settings?: any): SVGRectElement {\r\n        const rectElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\r\n        rectElement.setAttribute(\"x\", x.toString());\r\n        rectElement.setAttribute(\"y\", y.toString());\r\n        rectElement.setAttribute(\"width\", width.toString());\r\n        rectElement.setAttribute(\"height\", height.toString());\r\n        if (rx !== undefined) {\r\n            if (rx instanceof Number) {\r\n                rectElement.setAttribute(\"rx\", rx.toString());\r\n            } else if (rx instanceof Object) {\r\n                this._appendSettings(rx, rectElement);\r\n            }\r\n        }\r\n        if (ry !== undefined) {\r\n            rectElement.setAttribute(\"ry\", ry.toString());\r\n        }\r\n        this._appendSettings(settings, rectElement);\r\n        parent.appendChild(rectElement);\r\n        return rectElement;\r\n    }\r\n\r\n    public line(parent: Element, x1: number, y1: number, x2: number, y2: number, settings?: any): SVGLineElement {\r\n        const lineElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"line\");\r\n        lineElement.setAttribute(\"x1\", x1.toString());\r\n        lineElement.setAttribute(\"y1\", y1.toString());\r\n        lineElement.setAttribute(\"x2\", x2.toString());\r\n        lineElement.setAttribute(\"y2\", y2.toString());\r\n        this._appendSettings(settings, lineElement);\r\n        parent.appendChild(lineElement);\r\n        return lineElement;\r\n    }\r\n\r\n    public polygon(parent: Element, points: number[][], settings?: any): SVGPolygonElement {\r\n        const polygonElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"polygon\");\r\n        polygonElement.setAttribute(\"points\", points.map((point) => point.join(\",\")).join(\" \"));\r\n        this._appendSettings(settings, polygonElement);\r\n        parent.appendChild(polygonElement);\r\n        return polygonElement;\r\n    }\r\n\r\n    public polyline(parent: Element, points: number[][], settings?: any): SVGPolylineElement {\r\n        const polylineElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"polyline\");\r\n        polylineElement.setAttribute(\"points\", points.map((point) => point.join(\",\")).join(\" \"));\r\n        this._appendSettings(settings, polylineElement);\r\n        parent.appendChild(polylineElement);\r\n        return polylineElement;\r\n    }\r\n\r\n    public ellipse(parent: Element, cx: number, cy: number, rx: number, ry: number, settings?: any): SVGEllipseElement {\r\n        const ellipseElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"ellipse\");\r\n        ellipseElement.setAttribute(\"cx\", cx.toString());\r\n        ellipseElement.setAttribute(\"cy\", cy.toString());\r\n        ellipseElement.setAttribute(\"rx\", rx.toString());\r\n        ellipseElement.setAttribute(\"ry\", ry.toString());\r\n        this._appendSettings(settings, ellipseElement);\r\n        parent.appendChild(ellipseElement);\r\n        return ellipseElement;\r\n    }\r\n\r\n    public path(parent: SVGElement, builder: SVGPathBuilder, settings?: any): SVGPathElement {\r\n        const pathElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\r\n        pathElement.setAttribute(\"d\", builder.path());\r\n        this._appendSettings(settings, pathElement);\r\n        parent.appendChild(pathElement);\r\n        return pathElement;\r\n    }\r\n\r\n    public text(parent: Element, x: number, y: number, value: string, settings?: any): SVGTextElement {\r\n        const textElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"text\");\r\n        textElement.setAttribute(\"x\", x.toString());\r\n        textElement.setAttribute(\"y\", y.toString());\r\n        this._appendSettings(settings, textElement);\r\n        const textNode = document.createTextNode(value);\r\n        textElement.appendChild(textNode);\r\n        parent.appendChild(textElement);\r\n        return textElement;\r\n    }\r\n\r\n    public filter(parent: Element,\r\n                  id: string,\r\n                  x: number,\r\n                  y: number,\r\n                  width: number,\r\n                  height: number,\r\n                  settings?: any): SVGFilterElement {\r\n        const filterElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"filter\");\r\n        filterElement.setAttribute(\"x\", x.toString());\r\n        filterElement.setAttribute(\"y\", y.toString());\r\n        filterElement.setAttribute(\"width\", width.toString());\r\n        filterElement.setAttribute(\"height\", height.toString());\r\n        this._appendSettings(settings, filterElement);\r\n        parent.appendChild(filterElement);\r\n        return filterElement;\r\n    }\r\n\r\n    public pattern(parent: Element,\r\n                   resultId: string,\r\n                   x: number,\r\n                   y: number,\r\n                   width: number,\r\n                   height: number,\r\n                   settings?: any): SVGPatternElement {\r\n        const patternElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"pattern\");\r\n        if (resultId) {\r\n            patternElement.setAttribute(\"id\", resultId);\r\n        }\r\n        patternElement.setAttribute(\"x\", x.toString());\r\n        patternElement.setAttribute(\"y\", y.toString());\r\n        patternElement.setAttribute(\"width\", width.toString());\r\n        patternElement.setAttribute(\"height\", height.toString());\r\n        this._appendSettings(settings, patternElement);\r\n        parent.appendChild(patternElement);\r\n        return patternElement;\r\n    }\r\n\r\n    public defs(): SVGDefsElement {\r\n        if (this._defs === undefined) {\r\n            const defsElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\r\n            this._svg.appendChild(defsElement);\r\n            this._defs = defsElement;\r\n        }\r\n        return this._defs;\r\n    }\r\n\r\n    public clipPath(parent: Element, resultId: string, units?: string, settings?: any): SVGClipPathElement {\r\n        const clipElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"clipPath\");\r\n        if (resultId) {\r\n            clipElement.setAttribute(\"id\", resultId);\r\n        }\r\n        if (units === undefined) {\r\n            units = \"userSpaceOnUse\";\r\n        }\r\n        clipElement.setAttribute(\"clipPathUnits\", units);\r\n        this._appendSettings(settings, clipElement);\r\n        parent.appendChild(clipElement);\r\n        return clipElement;\r\n    }\r\n\r\n    public createPath(): SVGPathBuilder {\r\n        return new SVGPathBuilder();\r\n    }\r\n\r\n    private _appendSettings(settings: any | undefined, element: Element): void {\r\n        if (settings !== undefined) {\r\n            Object.keys(settings).forEach((key) => {\r\n                element.setAttribute(key, settings[key]);\r\n            });\r\n        }\r\n    }\r\n\r\n}\r\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2016 Tom Zoehner\r\nCopyright (c) 2018 Thomas Bluemel\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nimport { EMFJSError } from \"./Helper\";\r\n\r\nexport class Blob {\r\n    public pos: number;\r\n    private blob: Blob | ArrayBuffer;\r\n    private data: Uint8Array;\r\n\r\n    constructor(blob: Blob | ArrayBuffer, offset?: number) {\r\n        if (blob instanceof Blob) {\r\n            this.blob = blob.blob;\r\n            this.data = blob.data;\r\n            this.pos = offset || blob.pos;\r\n        } else {\r\n            this.blob = blob;\r\n            this.data = new Uint8Array(blob);\r\n            this.pos = offset || 0;\r\n        }\r\n    }\r\n\r\n    public eof(): boolean {\r\n        return this.pos >= this.data.length;\r\n    }\r\n\r\n    public seek(newpos: number): void {\r\n        if (newpos < 0 || newpos > this.data.length) {\r\n            throw new EMFJSError(\"Invalid seek position\");\r\n        }\r\n        this.pos = newpos;\r\n    }\r\n\r\n    public skip(cnt: number): void {\r\n        const newPos = this.pos + cnt;\r\n        if (newPos > this.data.length) {\r\n            throw new EMFJSError(\"Unexpected end of file\");\r\n        }\r\n        this.pos = newPos;\r\n    }\r\n\r\n    public readBinary(cnt: number): string {\r\n        const end = this.pos + cnt;\r\n        if (end > this.data.length) {\r\n            throw new EMFJSError(\"Unexpected end of file\");\r\n        }\r\n        let ret = \"\";\r\n        while (cnt-- > 0) {\r\n            ret += String.fromCharCode(this.data[this.pos++]);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public readInt8(): number {\r\n        if (this.pos + 1 > this.data.length) {\r\n            throw new EMFJSError(\"Unexpected end of file\");\r\n        }\r\n        return this.data[this.pos++];\r\n    }\r\n\r\n    public readUint8(): number {\r\n        return this.readInt8() >>> 0;\r\n    }\r\n\r\n    public readInt32(): number {\r\n        if (this.pos + 4 > this.data.length) {\r\n            throw new EMFJSError(\"Unexpected end of file\");\r\n        }\r\n        let val = this.data[this.pos++];\r\n        val |= this.data[this.pos++] << 8;\r\n        val |= this.data[this.pos++] << 16;\r\n        val |= this.data[this.pos++] << 24;\r\n        return val;\r\n    }\r\n\r\n    public readUint32(): number {\r\n        return this.readInt32() >>> 0;\r\n    }\r\n\r\n    public readUint16(): number {\r\n        if (this.pos + 2 > this.data.length) {\r\n            throw new EMFJSError(\"Unexpected end of file\");\r\n        }\r\n        let val = this.data[this.pos++];\r\n        val |= this.data[this.pos++] << 8;\r\n        return val;\r\n    }\r\n\r\n    public readInt16(): number {\r\n        let val = this.readUint16();\r\n        if (val > 32767) {\r\n            val -= 65536;\r\n        }\r\n        return val;\r\n    }\r\n\r\n    public readString(length: number): string {\r\n        if (this.pos + length > this.data.length) {\r\n            throw new EMFJSError(\"Unexpected end of file\");\r\n        }\r\n        let ret = \"\";\r\n        for (let i = 0; i < length; i++) {\r\n            ret += String.fromCharCode(this.data[this.pos++] >>> 0);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public readNullTermString(maxSize: number): string {\r\n        let ret = \"\";\r\n        if (maxSize > 0) {\r\n            maxSize--;\r\n            for (let i = 0; i < maxSize; i++) {\r\n                if (this.pos + i + 1 > this.data.length) {\r\n                    throw new EMFJSError(\"Unexpected end of file\");\r\n                }\r\n                const byte = this.data[this.pos + i] >>> 0;\r\n                if (byte === 0) {\r\n                    break;\r\n                }\r\n                ret += String.fromCharCode(byte);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public readFixedSizeUnicodeString(fixedSizeChars: number): string {\r\n        let ret = \"\";\r\n        for (let i = 0; i < fixedSizeChars; i++) {\r\n            const charCode = this.readUint16();\r\n            if (charCode === 0) {\r\n                if (++i < fixedSizeChars) {\r\n                    this.skip((fixedSizeChars - i) * 2);\r\n                }\r\n                break;\r\n            }\r\n            ret += String.fromCharCode(charCode);\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2016 Tom Zoehner\r\nCopyright (c) 2018 Thomas Bluemel\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nexport class EMFJSError extends Error {\r\n    constructor(message: string) {\r\n        super(message); // 'Error' breaks prototype chain here\r\n        Object.setPrototypeOf(this, new.target.prototype); // restore prototype chain\r\n    }\r\n}\r\n\r\nlet isLoggingEnabled = true;\r\n\r\nexport function loggingEnabled(enabled: boolean): void {\r\n    isLoggingEnabled = enabled;\r\n}\r\n\r\nexport class Helper {\r\n    public static GDI = {\r\n        FormatSignature: {\r\n            ENHMETA_SIGNATURE: 0x464D4520,\r\n            EPS_SIGNATURE: 0x46535045,\r\n        },\r\n        BITMAPINFOHEADER_SIZE: 40,\r\n        BITMAPCOREHEADER_SIZE: 12,\r\n        RecordType: {\r\n            EMR_POLYBEZIER: 0x00000002,\r\n            EMR_POLYGON: 0x00000003,\r\n            EMR_POLYLINE: 0x00000004,\r\n            EMR_POLYBEZIERTO: 0x00000005,\r\n            EMR_POLYLINETO: 0x00000006,\r\n            EMR_POLYPOLYLINE: 0x00000007,\r\n            EMR_POLYPOLYGON: 0x00000008,\r\n            EMR_SETWINDOWEXTEX: 0x00000009,\r\n            EMR_SETWINDOWORGEX: 0x0000000A,\r\n            EMR_SETVIEWPORTEXTEX: 0x0000000B,\r\n            EMR_SETVIEWPORTORGEX: 0x0000000C,\r\n            EMR_SETBRUSHORGEX: 0x0000000D,\r\n            EMR_EOF: 0x0000000E,\r\n            EMR_SETPIXELV: 0x0000000F,\r\n            EMR_SETMAPPERFLAGS: 0x00000010,\r\n            EMR_SETMAPMODE: 0x00000011,\r\n            EMR_SETBKMODE: 0x00000012,\r\n            EMR_SETPOLYFILLMODE: 0x00000013,\r\n            EMR_SETROP2: 0x00000014,\r\n            EMR_SETSTRETCHBLTMODE: 0x00000015,\r\n            EMR_SETTEXTALIGN: 0x00000016,\r\n            EMR_SETCOLORADJUSTMENT: 0x00000017,\r\n            EMR_SETTEXTCOLOR: 0x00000018,\r\n            EMR_SETBKCOLOR: 0x00000019,\r\n            EMR_OFFSETCLIPRGN: 0x0000001A,\r\n            EMR_MOVETOEX: 0x0000001B,\r\n            EMR_SETMETARGN: 0x0000001C,\r\n            EMR_EXCLUDECLIPRECT: 0x0000001D,\r\n            EMR_INTERSECTCLIPRECT: 0x0000001E,\r\n            EMR_SCALEVIEWPORTEXTEX: 0x0000001F,\r\n            EMR_SCALEWINDOWEXTEX: 0x00000020,\r\n            EMR_SAVEDC: 0x00000021,\r\n            EMR_RESTOREDC: 0x00000022,\r\n            EMR_SETWORLDTRANSFORM: 0x00000023,\r\n            EMR_MODIFYWORLDTRANSFORM: 0x00000024,\r\n            EMR_SELECTOBJECT: 0x00000025,\r\n            EMR_CREATEPEN: 0x00000026,\r\n            EMR_CREATEBRUSHINDIRECT: 0x00000027,\r\n            EMR_DELETEOBJECT: 0x00000028,\r\n            EMR_ANGLEARC: 0x00000029,\r\n            EMR_ELLIPSE: 0x0000002A,\r\n            EMR_RECTANGLE: 0x0000002B,\r\n            EMR_ROUNDRECT: 0x0000002C,\r\n            EMR_ARC: 0x0000002D,\r\n            EMR_CHORD: 0x0000002E,\r\n            EMR_PIE: 0x0000002F,\r\n            EMR_SELECTPALETTE: 0x00000030,\r\n            EMR_CREATEPALETTE: 0x00000031,\r\n            EMR_SETPALETTEENTRIES: 0x00000032,\r\n            EMR_RESIZEPALETTE: 0x00000033,\r\n            EMR_REALIZEPALETTE: 0x00000034,\r\n            EMR_EXTFLOODFILL: 0x00000035,\r\n            EMR_LINETO: 0x00000036,\r\n            EMR_ARCTO: 0x00000037,\r\n            EMR_POLYDRAW: 0x00000038,\r\n            EMR_SETARCDIRECTION: 0x00000039,\r\n            EMR_SETMITERLIMIT: 0x0000003A,\r\n            EMR_BEGINPATH: 0x0000003B,\r\n            EMR_ENDPATH: 0x0000003C,\r\n            EMR_CLOSEFIGURE: 0x0000003D,\r\n            EMR_FILLPATH: 0x0000003E,\r\n            EMR_STROKEANDFILLPATH: 0x0000003F,\r\n            EMR_STROKEPATH: 0x00000040,\r\n            EMR_FLATTENPATH: 0x00000041,\r\n            EMR_WIDENPATH: 0x00000042,\r\n            EMR_SELECTCLIPPATH: 0x00000043,\r\n            EMR_ABORTPATH: 0x00000044,\r\n            EMR_COMMENT: 0x00000046,\r\n            EMR_FILLRGN: 0x00000047,\r\n            EMR_FRAMERGN: 0x00000048,\r\n            EMR_INVERTRGN: 0x00000049,\r\n            EMR_PAINTRGN: 0x0000004A,\r\n            EMR_EXTSELECTCLIPRGN: 0x0000004B,\r\n            EMR_BITBLT: 0x0000004C,\r\n            EMR_STRETCHBLT: 0x0000004D,\r\n            EMR_MASKBLT: 0x0000004E,\r\n            EMR_PLGBLT: 0x0000004F,\r\n            EMR_SETDIBITSTODEVICE: 0x00000050,\r\n            EMR_STRETCHDIBITS: 0x00000051,\r\n            EMR_EXTCREATEFONTINDIRECTW: 0x00000052,\r\n            EMR_EXTTEXTOUTA: 0x00000053,\r\n            EMR_EXTTEXTOUTW: 0x00000054,\r\n            EMR_POLYBEZIER16: 0x00000055,\r\n            EMR_POLYGON16: 0x00000056,\r\n            EMR_POLYLINE16: 0x00000057,\r\n            EMR_POLYBEZIERTO16: 0x00000058,\r\n            EMR_POLYLINETO16: 0x00000059,\r\n            EMR_POLYPOLYLINE16: 0x0000005A,\r\n            EMR_POLYPOLYGON16: 0x0000005B,\r\n            EMR_POLYDRAW16: 0x0000005C,\r\n            EMR_CREATEMONOBRUSH: 0x0000005D,\r\n            EMR_CREATEDIBPATTERNBRUSHPT: 0x0000005E,\r\n            EMR_EXTCREATEPEN: 0x0000005F,\r\n            EMR_POLYTEXTOUTA: 0x00000060,\r\n            EMR_POLYTEXTOUTW: 0x00000061,\r\n            EMR_SETICMMODE: 0x00000062,\r\n            EMR_CREATECOLORSPACE: 0x00000063,\r\n            EMR_SETCOLORSPACE: 0x00000064,\r\n            EMR_DELETECOLORSPACE: 0x00000065,\r\n            EMR_GLSRECORD: 0x00000066,\r\n            EMR_GLSBOUNDEDRECORD: 0x00000067,\r\n            EMR_PIXELFORMAT: 0x00000068,\r\n            EMR_DRAWESCAPE: 0x00000069,\r\n            EMR_EXTESCAPE: 0x0000006A,\r\n            EMR_SMALLTEXTOUT: 0x0000006C,\r\n            EMR_FORCEUFIMAPPING: 0x0000006D,\r\n            EMR_NAMEDESCAPE: 0x0000006E,\r\n            EMR_COLORCORRECTPALETTE: 0x0000006F,\r\n            EMR_SETICMPROFILEA: 0x00000070,\r\n            EMR_SETICMPROFILEW: 0x00000071,\r\n            EMR_ALPHABLEND: 0x00000072,\r\n            EMR_SETLAYOUT: 0x00000073,\r\n            EMR_TRANSPARENTBLT: 0x00000074,\r\n            EMR_GRADIENTFILL: 0x00000076,\r\n            EMR_SETLINKEDUFIS: 0x00000077,\r\n            EMR_SETTEXTJUSTIFICATION: 0x00000078,\r\n            EMR_COLORMATCHTOTARGETW: 0x00000079,\r\n            EMR_CREATECOLORSPACEW: 0x0000007A,\r\n        },\r\n        MetafileEscapes: {\r\n            NEWFRAME: 0x0001,\r\n            ABORTDOC: 0x0002,\r\n            NEXTBAND: 0x0003,\r\n            SETCOLORTABLE: 0x0004,\r\n            GETCOLORTABLE: 0x0005,\r\n            FLUSHOUT: 0x0006,\r\n            DRAFTMODE: 0x0007,\r\n            QUERYESCSUPPORT: 0x0008,\r\n            SETABORTPROC: 0x0009,\r\n            STARTDOC: 0x000a,\r\n            ENDDOC: 0x000b,\r\n            GETPHYSPAGESIZE: 0x000c,\r\n            GETPRINTINGOFFSET: 0x000d,\r\n            GETSCALINGFACTOR: 0x000e,\r\n            META_ESCAPE_ENHANCED_METAFILE: 0x000f,\r\n            SETPENWIDTH: 0x0010,\r\n            SETCOPYCOUNT: 0x0011,\r\n            SETPAPERSOURCE: 0x0012,\r\n            PASSTHROUGH: 0x0013,\r\n            GETTECHNOLOGY: 0x0014,\r\n            SETLINECAP: 0x0015,\r\n            SETLINEJOIN: 0x0016,\r\n            SETMITERLIMIT: 0x0017,\r\n            BANDINFO: 0x0018,\r\n            DRAWPATTERNRECT: 0x0019,\r\n            GETVECTORPENSIZE: 0x001a,\r\n            GETVECTORBRUSHSIZE: 0x001b,\r\n            ENABLEDUPLEX: 0x001c,\r\n            GETSETPAPERBINS: 0x001d,\r\n            GETSETPRINTORIENT: 0x001e,\r\n            ENUMPAPERBINS: 0x001f,\r\n            SETDIBSCALING: 0x0020,\r\n            EPSPRINTING: 0x0021,\r\n            ENUMPAPERMETRICS: 0x0022,\r\n            GETSETPAPERMETRICS: 0x0023,\r\n            POSTSCRIPT_DATA: 0x0025,\r\n            POSTSCRIPT_IGNORE: 0x0026,\r\n            GETDEVICEUNITS: 0x002a,\r\n            GETEXTENDEDTEXTMETRICS: 0x0100,\r\n            GETPAIRKERNTABLE: 0x0102,\r\n            EXTTEXTOUT: 0x0200,\r\n            GETFACENAME: 0x0201,\r\n            DOWNLOADFACE: 0x0202,\r\n            METAFILE_DRIVER: 0x0801,\r\n            QUERYDIBSUPPORT: 0x0c01,\r\n            BEGIN_PATH: 0x1000,\r\n            CLIP_TO_PATH: 0x1001,\r\n            END_PATH: 0x1002,\r\n            OPEN_CHANNEL: 0x100e,\r\n            DOWNLOADHEADER: 0x100f,\r\n            CLOSE_CHANNEL: 0x1010,\r\n            POSTSCRIPT_PASSTHROUGH: 0x1013,\r\n            ENCAPSULATED_POSTSCRIPT: 0x1014,\r\n            POSTSCRIPT_IDENTIFY: 0x1015,\r\n            POSTSCRIPT_INJECTION: 0x1016,\r\n            CHECKJPEGFORMAT: 0x1017,\r\n            CHECKPNGFORMAT: 0x1018,\r\n            GET_PS_FEATURESETTING: 0x1019,\r\n            MXDC_ESCAPE: 0x101a,\r\n            SPCLPASSTHROUGH2: 0x11d8,\r\n        },\r\n        MapMode: {\r\n            MM_TEXT: 1,\r\n            MM_LOMETRIC: 2,\r\n            MM_HIMETRIC: 3,\r\n            MM_LOENGLISH: 4,\r\n            MM_HIENGLISH: 5,\r\n            MM_TWIPS: 6,\r\n            MM_ISOTROPIC: 7,\r\n            MM_ANISOTROPIC: 8,\r\n        },\r\n        StretchMode: {\r\n            BLACKONWHITE: 1,\r\n            WHITEONBLACK: 2,\r\n            COLORONCOLOR: 3,\r\n            HALFTONE: 4,\r\n        },\r\n        MixMode: {\r\n            TRANSPARENT: 1,\r\n            OPAQUE: 2,\r\n        },\r\n        BrushStyle: {\r\n            BS_SOLID: 0,\r\n            BS_NULL: 1,\r\n            BS_HATCHED: 2,\r\n            BS_PATTERN: 3,\r\n            BS_INDEXED: 4,\r\n            BS_DIBPATTERN: 5,\r\n            BS_DIBPATTERNPT: 6,\r\n            BS_PATTERN8X8: 7,\r\n            BS_DIBPATTERN8X8: 8,\r\n            BS_MONOPATTERN: 9,\r\n        },\r\n        PenStyle: {\r\n            PS_COSMETIC: 0x00000000,\r\n            PS_ENDCAP_ROUND: 0x00000000,\r\n            PS_JOIN_ROUND: 0x00000000,\r\n            PS_SOLID: 0x00000000,\r\n            PS_DASH: 0x00000001,\r\n            PS_DOT: 0x00000002,\r\n            PS_DASHDOT: 0x00000003,\r\n            PS_DASHDOTDOT: 0x00000004,\r\n            PS_NULL: 0x00000005,\r\n            PS_INSIDEFRAME: 0x00000006,\r\n            PS_USERSTYLE: 0x00000007,\r\n            PS_ALTERNATE: 0x00000008,\r\n            PS_ENDCAP_SQUARE: 0x00000100,\r\n            PS_ENDCAP_FLAT: 0x00000200,\r\n            PS_JOIN_BEVEL: 0x00001000,\r\n            PS_JOIN_MITER: 0x00002000,\r\n            PS_GEOMETRIC: 0x00010000,\r\n        },\r\n        PolygonFillMode: {\r\n            ALTERNATE: 1,\r\n            WINDING: 2,\r\n        },\r\n        BitmapCompression: {\r\n            BI_RGB: 0,\r\n            BI_RLE8: 1,\r\n            BI_RLE4: 2,\r\n            BI_BITFIELDS: 3,\r\n            BI_JPEG: 4,\r\n            BI_PNG: 5,\r\n        },\r\n        RegionMode: {\r\n            RGN_AND: 1,\r\n            RGN_OR: 2,\r\n            RGN_XOR: 3,\r\n            RGN_DIFF: 4,\r\n            RGN_COPY: 5,\r\n        },\r\n        StockObject: {\r\n            WHITE_BRUSH: 0x80000000,\r\n            LTGRAY_BRUSH: 0x80000001,\r\n            GRAY_BRUSH: 0x80000002,\r\n            DKGRAY_BRUSH: 0x80000003,\r\n            BLACK_BRUSH: 0x80000004,\r\n            NULL_BRUSH: 0x80000005,\r\n            WHITE_PEN: 0x80000006,\r\n            BLACK_PEN: 0x80000007,\r\n            NULL_PEN: 0x80000008,\r\n            OEM_FIXED_FONT: 0x8000000A,\r\n            ANSI_FIXED_FONT: 0x8000000B,\r\n            ANSI_VAR_FONT: 0x8000000C,\r\n            SYSTEM_FONT: 0x8000000D,\r\n            DEVICE_DEFAULT_FONT: 0x8000000E,\r\n            DEFAULT_PALETTE: 0x8000000F,\r\n            SYSTEM_FIXED_FONT: 0x80000010,\r\n            DEFAULT_GUI_FONT: 0x80000011,\r\n            DC_BRUSH: 0x80000012,\r\n            DC_PEN: 0x80000013,\r\n        },\r\n    };\r\n\r\n    public static _uniqueId = 0;\r\n\r\n    public static log(message: string): void {\r\n        if (isLoggingEnabled) {\r\n            console.log(message);\r\n        }\r\n    }\r\n\r\n    public static _makeUniqueId(prefix: string): string {\r\n        return \"EMFJS_\" + prefix + (this._uniqueId++);\r\n    }\r\n\r\n    public static _writeUint32Val(uint8arr: Uint8Array, pos: number, val: number): void {\r\n        uint8arr[pos++] = val & 0xff;\r\n        uint8arr[pos++] = (val >>> 8) & 0xff;\r\n        uint8arr[pos++] = (val >>> 16) & 0xff;\r\n        uint8arr[pos++] = (val >>> 24) & 0xff;\r\n    }\r\n\r\n    public static _blobToBinary(blob: Uint8Array): string {\r\n        let ret = \"\";\r\n        const len = blob.length;\r\n        for (let i = 0; i < len; i++) {\r\n            ret += String.fromCharCode(blob[i]);\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2016 Tom Zoehner\r\nCopyright (c) 2018 Thomas Bluemel\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nimport { Blob } from \"./Blob\";\r\nimport { GDIContext } from \"./GDIContext\";\r\nimport { EMFJSError, Helper } from \"./Helper\";\r\nimport { PointL, PointS, RectL, SizeL } from \"./Primitives\";\r\nimport { Region } from \"./Region\";\r\nimport { Brush, ColorRef, Pen } from \"./Style\";\r\n\r\nclass EmfHeader {\r\n    private size: number;\r\n    private bounds: RectL;\r\n    private frame: RectL;\r\n    private nPalEntries: number;\r\n    private refDevCx: number;\r\n    private refDevCy: number;\r\n    private refDevCxMm: number;\r\n    private refDevCyMm: number;\r\n    private description: string;\r\n    private displayDevCxUm: number;\r\n    private displayDevCyUm: number;\r\n\r\n    constructor(reader: Blob, headerSize: number) {\r\n        const recordStart = reader.pos - 8;\r\n\r\n        this.size = headerSize;\r\n        this.bounds = new RectL(reader);\r\n        this.frame = new RectL(reader);\r\n        if (reader.readUint32() !== Helper.GDI.FormatSignature.ENHMETA_SIGNATURE) {\r\n            throw new EMFJSError(\"Invalid header signature\");\r\n        }\r\n        reader.skip(4); // version\r\n        reader.skip(4); // bytes (size of metafile)\r\n        reader.skip(4); // number of records\r\n        reader.skip(2); // number of handles\r\n        reader.skip(2); // reserved\r\n        const descriptionLen = reader.readUint32();\r\n        const descriptionOff = reader.readUint32();\r\n        this.nPalEntries = reader.readUint32();\r\n        this.refDevCx = reader.readUint32();\r\n        this.refDevCy = reader.readUint32();\r\n        this.refDevCxMm = reader.readUint32();\r\n        this.refDevCyMm = reader.readUint32();\r\n\r\n        let hdrSize = headerSize;\r\n        if (descriptionLen > 0) {\r\n            if (descriptionOff < 88) {\r\n                throw new EMFJSError(\"Invalid header description offset\");\r\n            }\r\n\r\n            hdrSize = descriptionOff + (descriptionLen * 2);\r\n            if (hdrSize > headerSize) {\r\n                throw new EMFJSError(\"Invalid header description length\");\r\n            }\r\n\r\n            const prevPos = reader.pos;\r\n            reader.seek(recordStart + descriptionOff);\r\n            this.description = reader.readFixedSizeUnicodeString(descriptionLen);\r\n            reader.seek(prevPos);\r\n        } else {\r\n            this.description = \"\";\r\n        }\r\n\r\n        if (hdrSize >= 100) {\r\n            // We have a EmfMetafileHeaderExtension1 record\r\n            const pixelFormatSize = reader.readUint32();\r\n            const pixelFormatOff = reader.readUint32();\r\n            const haveOpenGl = reader.readUint32();\r\n            if (haveOpenGl !== 0) {\r\n                throw new EMFJSError(\"OpenGL records are not yet supported\");\r\n            }\r\n\r\n            if (pixelFormatOff !== 0) {\r\n                if (pixelFormatOff < 100 || pixelFormatOff < hdrSize) {\r\n                    throw new EMFJSError(\"Invalid pixel format offset\");\r\n                }\r\n\r\n                hdrSize = pixelFormatOff + pixelFormatSize;\r\n                if (hdrSize > headerSize) {\r\n                    throw new EMFJSError(\"Invalid pixel format size\");\r\n                }\r\n\r\n                // TODO: read pixel format blob\r\n            }\r\n\r\n            if (hdrSize >= 108) {\r\n                // We have a EmfMetafileHeaderExtension2 record\r\n                this.displayDevCxUm = reader.readUint32(); // in micrometers\r\n                this.displayDevCyUm = reader.readUint32(); // in micrometers\r\n            }\r\n        }\r\n    }\r\n\r\n    public toString(): string {\r\n        return \"{bounds: \" + this.bounds.toString() + \", frame: \" + this.frame.toString()\r\n            + \", description: \" + this.description + \"}\";\r\n    }\r\n}\r\n\r\nexport class EMFRecords {\r\n    private _records: ((gdi: GDIContext) => void)[];\r\n    private _header: EmfHeader;\r\n\r\n    constructor(reader: Blob, first: number) {\r\n        this._records = [];\r\n\r\n        this._header = new EmfHeader(reader, first);\r\n\r\n        let all = false;\r\n        let curpos = first;\r\n        main_loop: while (!all) {\r\n            reader.seek(curpos);\r\n            const type = reader.readUint32();\r\n            const size = reader.readUint32();\r\n            if (size < 8) {\r\n                throw new EMFJSError(\"Invalid record size\");\r\n            }\r\n            switch (type) {\r\n                case Helper.GDI.RecordType.EMR_EOF:\r\n                    all = true;\r\n                    break main_loop;\r\n                case Helper.GDI.RecordType.EMR_SETMAPMODE: {\r\n                    const mapMode = reader.readInt32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.setMapMode(mapMode);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SETWINDOWORGEX: {\r\n                    const x = reader.readInt32();\r\n                    const y = reader.readInt32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.setWindowOrgEx(x, y);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SETWINDOWEXTEX: {\r\n                    const x = reader.readUint32();\r\n                    const y = reader.readUint32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.setWindowExtEx(x, y);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SETVIEWPORTORGEX: {\r\n                    const x = reader.readInt32();\r\n                    const y = reader.readInt32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.setViewportOrgEx(x, y);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SETVIEWPORTEXTEX: {\r\n                    const x = reader.readUint32();\r\n                    const y = reader.readUint32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.setViewportExtEx(x, y);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SAVEDC: {\r\n                    this._records.push((gdi) => {\r\n                        gdi.saveDC();\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_RESTOREDC: {\r\n                    const saved = reader.readInt32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.restoreDC(saved);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SETBKMODE: {\r\n                    const bkMode = reader.readUint32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.setBkMode(bkMode);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SETBKCOLOR: {\r\n                    const bkColor = new ColorRef(reader);\r\n                    this._records.push((gdi) => {\r\n                        gdi.setBkColor(bkColor);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_CREATEBRUSHINDIRECT: {\r\n                    const index = reader.readUint32();\r\n                    const brush = new Brush(reader);\r\n                    this._records.push((gdi) => {\r\n                        gdi.createBrush(index, brush);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_CREATEPEN: {\r\n                    const index = reader.readUint32();\r\n                    const pen = new Pen(reader, null);\r\n                    this._records.push((gdi) => {\r\n                        gdi.createPen(index, pen);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_EXTCREATEPEN: {\r\n                    const index = reader.readUint32();\r\n                    const offBmi = reader.readUint32();\r\n                    const cbBmi = reader.readUint32();\r\n                    const offBits = reader.readUint32();\r\n                    const cbBits = reader.readUint32();\r\n                    const pen = new Pen(reader, {\r\n                        header: {\r\n                            off: offBmi,\r\n                            size: cbBmi,\r\n                        },\r\n                        data: {\r\n                            off: offBits,\r\n                            size: cbBits,\r\n                        },\r\n                    });\r\n                    this._records.push((gdi) => {\r\n                        gdi.createPen(index, pen);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SELECTOBJECT: {\r\n                    const idx = reader.readUint32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.selectObject(idx, null);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_DELETEOBJECT: {\r\n                    const idx = reader.readUint32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.deleteObject(idx);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_RECTANGLE: {\r\n                    const rect = new RectL(reader);\r\n                    this._records.push((gdi) => {\r\n                        gdi.rectangle(rect, 0, 0);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_ROUNDRECT: {\r\n                    const rect = new RectL(reader);\r\n                    const corner = new SizeL(reader);\r\n                    this._records.push((gdi) => {\r\n                        gdi.rectangle(rect, corner.cx, corner.cy);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_LINETO: {\r\n                    const x = reader.readInt32();\r\n                    const y = reader.readInt32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.lineTo(x, y);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_MOVETOEX: {\r\n                    const x = reader.readInt32();\r\n                    const y = reader.readInt32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.moveToEx(x, y);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_POLYGON:\r\n                case Helper.GDI.RecordType.EMR_POLYGON16: {\r\n                    const isSmall = (type === Helper.GDI.RecordType.EMR_POLYGON16);\r\n                    const bounds = new RectL(reader);\r\n                    let cnt = reader.readUint32();\r\n                    const points: PointS[] | PointL[] = [];\r\n                    while (cnt > 0) {\r\n                        points.push(isSmall ? new PointS(reader) : new PointL(reader));\r\n                        cnt--;\r\n                    }\r\n                    this._records.push((gdi) => {\r\n                        gdi.polygon(points, bounds, true);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_POLYPOLYGON:\r\n                case Helper.GDI.RecordType.EMR_POLYPOLYGON16: {\r\n                    const isSmall = (type === Helper.GDI.RecordType.EMR_POLYPOLYGON16);\r\n                    const bounds = new RectL(reader);\r\n                    const polyCnt = reader.readUint32();\r\n                    reader.skip(4); // count\r\n                    const polygonsPtCnts = [];\r\n                    for (let i = 0; i < polyCnt; i++) {\r\n                        polygonsPtCnts.push(reader.readUint32());\r\n                    }\r\n\r\n                    const polygons: PointS[][] | PointL[][] = [];\r\n                    for (let i = 0; i < polyCnt; i++) {\r\n                        const ptCnt = polygonsPtCnts[i];\r\n\r\n                        const p = [];\r\n                        for (let ip = 0; ip < ptCnt; ip++) {\r\n                            p.push(isSmall ? new PointS(reader) : new PointL(reader));\r\n                        }\r\n                        polygons.push(p);\r\n                    }\r\n                    this._records.push((gdi) => {\r\n                        gdi.polyPolygon(polygons, bounds);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SETPOLYFILLMODE: {\r\n                    const polyfillmode = reader.readUint32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.setPolyFillMode(polyfillmode);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_POLYLINE16:\r\n                case Helper.GDI.RecordType.EMR_POLYLINETO16: {\r\n                    const isLineTo = (type === Helper.GDI.RecordType.EMR_POLYLINETO16);\r\n                    const bounds = new RectL(reader);\r\n                    let cnt = reader.readUint32();\r\n                    const points: PointS[] = [];\r\n                    while (cnt > 0) {\r\n                        points.push(new PointS(reader));\r\n                        cnt--;\r\n                    }\r\n                    this._records.push((gdi) => {\r\n                        gdi.polyline(isLineTo, points, bounds);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_POLYBEZIER:\r\n                case Helper.GDI.RecordType.EMR_POLYBEZIERTO: {\r\n                    const isPolyBezierTo = (type === Helper.GDI.RecordType.EMR_POLYBEZIERTO);\r\n                    const bounds = new RectL(reader);\r\n                    let cnt = reader.readUint32();\r\n                    const points: PointL[] = [];\r\n                    while (cnt > 0) {\r\n                        points.push(new PointL(reader));\r\n                        cnt--;\r\n                    }\r\n                    this._records.push((gdi) => {\r\n                        gdi.polybezier(isPolyBezierTo, points, bounds);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_POLYBEZIER16: {\r\n                    const bounds = new RectL(reader);\r\n                    const start = new PointL(reader);\r\n                    let cnt = reader.readUint32();\r\n                    const points = [start];\r\n                    while (cnt > 0) {\r\n                        points.push(new PointS(reader));\r\n                        cnt--;\r\n                    }\r\n                    this._records.push((gdi) => {\r\n                        gdi.polybezier(false, points, bounds);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_POLYBEZIERTO16: {\r\n                    const bounds = new RectL(reader);\r\n                    let cnt = reader.readUint32();\r\n                    const points: PointS[] = [];\r\n                    while (cnt > 0) {\r\n                        points.push(new PointS(reader));\r\n                        cnt--;\r\n                    }\r\n                    this._records.push((gdi) => {\r\n                        gdi.polybezier(true, points, bounds);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SETTEXTALIGN: {\r\n                    const textAlign = reader.readUint32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.setTextAlign(textAlign);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SETSTRETCHBLTMODE: {\r\n                    const stretchMode = reader.readUint32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.setStretchBltMode(stretchMode);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SETBRUSHORGEX: {\r\n                    const origin = new PointL(reader);\r\n                    this._records.push((gdi) => {\r\n                        gdi.setBrushOrgEx(origin);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_BEGINPATH: {\r\n                    this._records.push((gdi) => {\r\n                        gdi.beginPath();\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_ENDPATH: {\r\n                    this._records.push((gdi) => {\r\n                        gdi.endPath();\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_ABORTPATH: {\r\n                    this._records.push((gdi) => {\r\n                        gdi.abortPath();\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_CLOSEFIGURE: {\r\n                    this._records.push((gdi) => {\r\n                        gdi.closeFigure();\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_FILLPATH: {\r\n                    const bounds = new RectL(reader);\r\n                    this._records.push((gdi) => {\r\n                        gdi.fillPath(bounds);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_STROKEPATH: {\r\n                    const bounds = new RectL(reader);\r\n                    this._records.push((gdi) => {\r\n                        gdi.strokePath(bounds);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SELECTCLIPPATH: {\r\n                    const rgnMode = reader.readUint32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.selectClipPath(rgnMode);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_EXTSELECTCLIPRGN: {\r\n                    reader.skip(4);\r\n                    const rgnMode = reader.readUint32();\r\n                    const region = rgnMode !== Helper.GDI.RegionMode.RGN_COPY ? new Region(reader) : null;\r\n                    this._records.push((gdi) => {\r\n                        gdi.selectClipRgn(rgnMode, region);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_OFFSETCLIPRGN: {\r\n                    const offset = new PointL(reader);\r\n                    this._records.push((gdi) => {\r\n                        gdi.offsetClipRgn(offset);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_SETMITERLIMIT: {\r\n                    const miterLimit = reader.readUint32();\r\n                    this._records.push((gdi) => {\r\n                        gdi.setMiterLimit(miterLimit);\r\n                    });\r\n                    break;\r\n                }\r\n                case Helper.GDI.RecordType.EMR_POLYLINE:\r\n                case Helper.GDI.RecordType.EMR_POLYLINETO:\r\n                case Helper.GDI.RecordType.EMR_POLYPOLYLINE:\r\n                case Helper.GDI.RecordType.EMR_SETPIXELV:\r\n                case Helper.GDI.RecordType.EMR_SETMAPPERFLAGS:\r\n                case Helper.GDI.RecordType.EMR_SETROP2:\r\n                case Helper.GDI.RecordType.EMR_SETCOLORADJUSTMENT:\r\n                case Helper.GDI.RecordType.EMR_SETTEXTCOLOR:\r\n                case Helper.GDI.RecordType.EMR_SETMETARGN:\r\n                case Helper.GDI.RecordType.EMR_EXCLUDECLIPRECT:\r\n                case Helper.GDI.RecordType.EMR_INTERSECTCLIPRECT:\r\n                case Helper.GDI.RecordType.EMR_SCALEVIEWPORTEXTEX:\r\n                case Helper.GDI.RecordType.EMR_SCALEWINDOWEXTEX:\r\n                case Helper.GDI.RecordType.EMR_SETWORLDTRANSFORM:\r\n                case Helper.GDI.RecordType.EMR_MODIFYWORLDTRANSFORM:\r\n                case Helper.GDI.RecordType.EMR_ANGLEARC:\r\n                case Helper.GDI.RecordType.EMR_ELLIPSE:\r\n                case Helper.GDI.RecordType.EMR_ARC:\r\n                case Helper.GDI.RecordType.EMR_CHORD:\r\n                case Helper.GDI.RecordType.EMR_PIE:\r\n                case Helper.GDI.RecordType.EMR_SELECTPALETTE:\r\n                case Helper.GDI.RecordType.EMR_CREATEPALETTE:\r\n                case Helper.GDI.RecordType.EMR_SETPALETTEENTRIES:\r\n                case Helper.GDI.RecordType.EMR_RESIZEPALETTE:\r\n                case Helper.GDI.RecordType.EMR_REALIZEPALETTE:\r\n                case Helper.GDI.RecordType.EMR_EXTFLOODFILL:\r\n                case Helper.GDI.RecordType.EMR_ARCTO:\r\n                case Helper.GDI.RecordType.EMR_POLYDRAW:\r\n                case Helper.GDI.RecordType.EMR_SETARCDIRECTION:\r\n                case Helper.GDI.RecordType.EMR_STROKEANDFILLPATH:\r\n                case Helper.GDI.RecordType.EMR_FLATTENPATH:\r\n                case Helper.GDI.RecordType.EMR_WIDENPATH:\r\n                case Helper.GDI.RecordType.EMR_COMMENT:\r\n                case Helper.GDI.RecordType.EMR_FILLRGN:\r\n                case Helper.GDI.RecordType.EMR_FRAMERGN:\r\n                case Helper.GDI.RecordType.EMR_INVERTRGN:\r\n                case Helper.GDI.RecordType.EMR_PAINTRGN:\r\n                case Helper.GDI.RecordType.EMR_BITBLT:\r\n                case Helper.GDI.RecordType.EMR_STRETCHBLT:\r\n                case Helper.GDI.RecordType.EMR_MASKBLT:\r\n                case Helper.GDI.RecordType.EMR_PLGBLT:\r\n                case Helper.GDI.RecordType.EMR_SETDIBITSTODEVICE:\r\n                case Helper.GDI.RecordType.EMR_STRETCHDIBITS:\r\n                case Helper.GDI.RecordType.EMR_EXTCREATEFONTINDIRECTW:\r\n                case Helper.GDI.RecordType.EMR_EXTTEXTOUTA:\r\n                case Helper.GDI.RecordType.EMR_EXTTEXTOUTW:\r\n                case Helper.GDI.RecordType.EMR_POLYPOLYLINE16:\r\n                case Helper.GDI.RecordType.EMR_POLYDRAW16:\r\n                case Helper.GDI.RecordType.EMR_CREATEMONOBRUSH:\r\n                case Helper.GDI.RecordType.EMR_CREATEDIBPATTERNBRUSHPT:\r\n                case Helper.GDI.RecordType.EMR_POLYTEXTOUTA:\r\n                case Helper.GDI.RecordType.EMR_POLYTEXTOUTW:\r\n                case Helper.GDI.RecordType.EMR_SETICMMODE:\r\n                case Helper.GDI.RecordType.EMR_CREATECOLORSPACE:\r\n                case Helper.GDI.RecordType.EMR_SETCOLORSPACE:\r\n                case Helper.GDI.RecordType.EMR_DELETECOLORSPACE:\r\n                case Helper.GDI.RecordType.EMR_GLSRECORD:\r\n                case Helper.GDI.RecordType.EMR_GLSBOUNDEDRECORD:\r\n                case Helper.GDI.RecordType.EMR_PIXELFORMAT:\r\n                case Helper.GDI.RecordType.EMR_DRAWESCAPE:\r\n                case Helper.GDI.RecordType.EMR_EXTESCAPE:\r\n                case Helper.GDI.RecordType.EMR_SMALLTEXTOUT:\r\n                case Helper.GDI.RecordType.EMR_FORCEUFIMAPPING:\r\n                case Helper.GDI.RecordType.EMR_NAMEDESCAPE:\r\n                case Helper.GDI.RecordType.EMR_COLORCORRECTPALETTE:\r\n                case Helper.GDI.RecordType.EMR_SETICMPROFILEA:\r\n                case Helper.GDI.RecordType.EMR_SETICMPROFILEW:\r\n                case Helper.GDI.RecordType.EMR_ALPHABLEND:\r\n                case Helper.GDI.RecordType.EMR_SETLAYOUT:\r\n                case Helper.GDI.RecordType.EMR_TRANSPARENTBLT:\r\n                case Helper.GDI.RecordType.EMR_GRADIENTFILL:\r\n                case Helper.GDI.RecordType.EMR_SETLINKEDUFIS:\r\n                case Helper.GDI.RecordType.EMR_SETTEXTJUSTIFICATION:\r\n                case Helper.GDI.RecordType.EMR_COLORMATCHTOTARGETW:\r\n                case Helper.GDI.RecordType.EMR_CREATECOLORSPACEW:\r\n                default: {\r\n                    let recordName = \"UNKNOWN\";\r\n                    for (const name in Helper.GDI.RecordType) {\r\n                        const recordTypes: any = Helper.GDI.RecordType;\r\n                        if (recordTypes[name] === type) {\r\n                            recordName = name;\r\n                            break;\r\n                        }\r\n                    }\r\n                    Helper.log(\"[EMF] \" + recordName + \" record (0x\" + type.toString(16) + \") at offset 0x\"\r\n                        + curpos.toString(16) + \" with \" + size + \" bytes\");\r\n                    break;\r\n                }\r\n            }\r\n\r\n            curpos += size;\r\n        }\r\n\r\n        if (!all) {\r\n            throw new EMFJSError(\"Could not read all records\");\r\n        }\r\n    }\r\n\r\n    public play(gdi: GDIContext): void {\r\n        const len = this._records.length;\r\n        for (let i = 0; i < len; i++) {\r\n            this._records[i](gdi);\r\n        }\r\n    }\r\n}\r\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2016 Tom Zoehner\r\nCopyright (c) 2018 Thomas Bluemel\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nimport { Blob } from \"./Blob\";\r\nimport { EMFJSError } from \"./Helper\";\r\n\r\nexport class PointS {\r\n    public x: number;\r\n    public y: number;\r\n\r\n    constructor(reader: Blob, x?: number, y?: number) {\r\n        if (reader != null) {\r\n            this.x = reader.readInt16();\r\n            this.y = reader.readInt16();\r\n        } else {\r\n            this.x = x;\r\n            this.y = y;\r\n        }\r\n    }\r\n\r\n    public clone(): PointS {\r\n        return new PointS(null, this.x, this.y);\r\n    }\r\n\r\n    public toString(): string {\r\n        return \"{x: \" + this.x + \", y: \" + this.y + \"}\";\r\n    }\r\n}\r\n\r\nexport class PointL {\r\n    public x: number;\r\n    public y: number;\r\n\r\n    constructor(reader: Blob, x?: number, y?: number) {\r\n        if (reader != null) {\r\n            this.x = reader.readInt32();\r\n            this.y = reader.readInt32();\r\n        } else {\r\n            this.x = x;\r\n            this.y = y;\r\n        }\r\n    }\r\n\r\n    public clone(): PointL {\r\n        return new PointL(null, this.x, this.y);\r\n    }\r\n\r\n    public toString(): string {\r\n        return \"{x: \" + this.x + \", y: \" + this.y + \"}\";\r\n    }\r\n}\r\n\r\nexport class RectL {\r\n    public left: number;\r\n    public top: number;\r\n    public right: number;\r\n    public bottom: number;\r\n\r\n    constructor(reader: Blob, left?: number, top?: number, right?: number, bottom?: number) {\r\n        if (reader != null) {\r\n            this.left = reader.readInt32();\r\n            this.top = reader.readInt32();\r\n            this.right = reader.readInt32();\r\n            this.bottom = reader.readInt32();\r\n        } else {\r\n            this.bottom = bottom;\r\n            this.right = right;\r\n            this.top = top;\r\n            this.left = left;\r\n        }\r\n    }\r\n\r\n    public clone(): RectL {\r\n        return new RectL(null, this.left, this.top, this.right, this.bottom);\r\n    }\r\n\r\n    public toString(): string {\r\n        return \"{left: \" + this.left + \", top: \" + this.top + \", right: \" + this.right\r\n            + \", bottom: \" + this.bottom + \"}\";\r\n    }\r\n\r\n    public empty(): boolean {\r\n        return this.left >= this.right || this.top >= this.bottom;\r\n    }\r\n\r\n    public intersect(rectL: RectL): null | RectL {\r\n        if (this.empty() || rectL.empty()) {\r\n            return null;\r\n        }\r\n        if (this.left >= rectL.right || this.top >= rectL.bottom ||\r\n            this.right <= rectL.left || this.bottom <= rectL.top) {\r\n            return null;\r\n        }\r\n        return new RectL(null, Math.max(this.left, rectL.left), Math.max(this.top, rectL.top),\r\n            Math.min(this.right, rectL.right), Math.min(this.bottom, rectL.bottom));\r\n    }\r\n}\r\n\r\nexport class SizeL {\r\n    public cx: number;\r\n    public cy: number;\r\n\r\n    constructor(reader: Blob, cx?: number, cy?: number) {\r\n        if (reader != null) {\r\n            this.cx = reader.readUint32();\r\n            this.cy = reader.readUint32();\r\n        } else {\r\n            this.cx = cx;\r\n            this.cy = cy;\r\n        }\r\n    }\r\n\r\n    public clone(): SizeL {\r\n        return new SizeL(null, this.cx, this.cy);\r\n    }\r\n\r\n    public toString(): string {\r\n        return \"{cx: \" + this.cx + \", cy: \" + this.cy + \"}\";\r\n    }\r\n}\r\n\r\nexport class Obj {\r\n    public type: string;\r\n\r\n    constructor(type: string) {\r\n        this.type = type;\r\n    }\r\n\r\n    public clone(): Obj {\r\n        throw new EMFJSError(\"clone not implemented\");\r\n    }\r\n\r\n    public toString(): string {\r\n        throw new EMFJSError(\"toString not implemented\");\r\n    }\r\n}\r\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2016 Tom Zoehner\r\nCopyright (c) 2018 Thomas Bluemel\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nimport { Blob } from \"./Blob\";\r\nimport { EMFJSError, Helper } from \"./Helper\";\r\nimport { Obj, RectL } from \"./Primitives\";\r\n\r\nexport class Region extends Obj {\r\n    public bounds: RectL;\r\n    public scans: Scan[];\r\n    public complexity: number;\r\n\r\n    constructor(reader: Blob, copy?: Region) {\r\n        super(\"region\");\r\n        if (reader != null) {\r\n            const hdrSize = reader.readUint32();\r\n            if (hdrSize !== 32) {\r\n                throw new EMFJSError(\"Invalid region header\");\r\n            }\r\n            reader.skip(4);\r\n            const rectCnt = reader.readUint32();\r\n            const rgnSize = reader.readUint32();\r\n            if (rectCnt * 16 !== rgnSize) {\r\n                throw new EMFJSError(\"Invalid region data\");\r\n            }\r\n\r\n            this.bounds = new RectL(reader);\r\n            this.scans = [];\r\n            let scanLine;\r\n            for (let i = 0; i < rectCnt; i++) {\r\n                const r = new RectL(reader);\r\n                if (!!scanLine || scanLine.top !== r.top || scanLine.bottom !== r.bottom) {\r\n                    scanLine = new Scan(r);\r\n                    this.scans.push(scanLine);\r\n                } else {\r\n                    scanLine.append(r);\r\n                }\r\n            }\r\n            this._updateComplexity();\r\n        } else if (copy != null) {\r\n            this.bounds = copy.bounds != null ? copy.bounds.clone() : null;\r\n            if (copy.scans != null) {\r\n                this.scans = [];\r\n                for (let i = 0; i < copy.scans.length; i++) {\r\n                    this.scans.push(copy.scans[i].clone());\r\n                }\r\n            } else {\r\n                this.scans = null;\r\n            }\r\n            this.complexity = copy.complexity;\r\n        } else {\r\n            this.bounds = null;\r\n            this.scans = null;\r\n            this.complexity = 0;\r\n        }\r\n    }\r\n\r\n    public clone(): Region {\r\n        return new Region(null, this);\r\n    }\r\n\r\n    public toString(): string {\r\n        const _complexity = [\"null\", \"simple\", \"complex\"];\r\n        return \"{complexity: \" + _complexity[this.complexity]\r\n            + \" bounds: \" + (this.bounds != null ? this.bounds.toString() : \"[none]\")\r\n            + \" #scans: \" + (this.scans != null ? this.scans.length : \"[none]\") + \"}\";\r\n    }\r\n\r\n    public _updateComplexity(): void {\r\n        if (this.bounds == null) {\r\n            this.complexity = 0;\r\n            this.scans = null;\r\n        } else if (this.bounds.empty()) {\r\n            this.complexity = 0;\r\n            this.scans = null;\r\n            this.bounds = null;\r\n        } else if (this.scans == null) {\r\n            this.complexity = 1;\r\n        } else {\r\n            this.complexity = 2;\r\n            if (this.scans.length === 1) {\r\n                const scan = this.scans[0];\r\n                if (scan.top === this.bounds.top && scan.bottom === this.bounds.bottom && scan.scanlines.length === 1) {\r\n                    const scanline = scan.scanlines[0];\r\n                    if (scanline.left === this.bounds.left && scanline.right === this.bounds.right) {\r\n                        this.scans = null;\r\n                        this.complexity = 1;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public subtract(rect: RectL): void {\r\n        Helper.log(\"[emf] Region \" + this.toString() + \" subtract \" + rect.toString());\r\n\r\n        if (this.bounds != null) {\r\n            const isect = this.bounds.intersect(rect);\r\n            if (isect != null) { // Only need to do anything if there is any chance of an overlap\r\n                if (this.scans == null) {\r\n                    // We currently have a simple region and there is some kind of an overlap.\r\n                    // We need to create scanlines now.  Simplest method is to fake one scan line\r\n                    // that equals the simple region and re-use the same logic as for complex regions\r\n                    this.scans = [];\r\n                    this.scans.push(new Scan(new RectL(null, this.bounds.left, this.bounds.top,\r\n                        this.bounds.right, this.bounds.bottom)));\r\n                    this.complexity = 2;\r\n                }\r\n\r\n                // We (now) have a complex region.  First we skip any scans that are entirely above rect.top\r\n                // The first scan that falls partially below rect.top needs to be split into two scans.\r\n                let si = 0;\r\n                while (si < this.scans.length) {\r\n                    const scan = this.scans[si];\r\n                    if (scan.bottom >= rect.top) {\r\n                        // We need to clone this scan into two so that we can subtract from the second one\r\n                        const cloned = scan.clone();\r\n                        scan.bottom = rect.top - 1;\r\n                        cloned.top = rect.top;\r\n                        if (scan.top >= scan.bottom) {\r\n                            this.scans[si] = cloned;\r\n                        } else {\r\n                            Helper.log(\"[emf] Region split top scan \" + si + \" for substraction\");\r\n                            this.scans.splice(++si, 0, cloned);\r\n                        }\r\n                        break;\r\n                    }\r\n                    si++;\r\n                }\r\n\r\n                // Now find the first one that falls at least partially below rect.bottom, which needs to be\r\n                // split if it is only partially below rect.bottom\r\n                const first = si;\r\n                while (si < this.scans.length) {\r\n                    const scan = this.scans[si];\r\n                    if (scan.top > rect.bottom) {\r\n                        break;\r\n                    }\r\n                    if (scan.bottom > rect.bottom) {\r\n                        // We need to clone this scan into two so that we can subtract from the first one\r\n                        const cloned = scan.clone();\r\n                        scan.bottom = rect.bottom;\r\n                        cloned.top = rect.bottom + 1;\r\n                        if (scan.top >= scan.bottom) {\r\n                            this.scans[si] = cloned;\r\n                        } else {\r\n                            Helper.log(\"[emf] Region split bottom scan \" + si + \" for substraction\");\r\n                            this.scans.splice(++si, 0, cloned);\r\n                        }\r\n                        break;\r\n                    }\r\n                    si++;\r\n                }\r\n\r\n                // Now perform a subtraction on each scan in between rect.top and rect.bottom.  Because we\r\n                // cloned scans that partially overlapped rect.top and rect.bottom, we don't have to\r\n                // account for this anymore.\r\n                if (first < this.scans.length) {\r\n                    let last = si;\r\n                    si = first;\r\n                    while (si < last) {\r\n                        const scan = this.scans[si];\r\n                        if (!scan.subtract(rect.left, rect.right)) {\r\n                            Helper.log(\"[emf] Region remove now empty scan \" + si + \" due to subtraction\");\r\n                            this.scans.splice(si, 1);\r\n                            last--;\r\n                            continue;\r\n                        }\r\n\r\n                        si++;\r\n                    }\r\n                }\r\n\r\n                // Update bounds\r\n                if (this.scans != null) {\r\n                    let left;\r\n                    let top;\r\n                    let right;\r\n                    let bottom;\r\n                    const len = this.scans.length;\r\n                    for (let i = 0; i < len; i++) {\r\n                        const scan = this.scans[i];\r\n                        if (i === 0) {\r\n                            top = scan.top;\r\n                        }\r\n                        if (i === len - 1) {\r\n                            bottom = scan.bottom;\r\n                        }\r\n\r\n                        const slen = scan.scanlines.length;\r\n                        if (slen > 0) {\r\n                            let scanline = scan.scanlines[0];\r\n                            if (left == null || scanline.left < left) {\r\n                                left = scanline.left;\r\n                            }\r\n                            scanline = scan.scanlines[slen - 1];\r\n                            if (right == null || scanline.right > right) {\r\n                                right = scanline.right;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (left != null && top != null && right != null && bottom != null) {\r\n                        this.bounds = new RectL(null, left, top, right, bottom);\r\n                        this._updateComplexity();\r\n                    } else {\r\n                        // This has to be a null region now\r\n                        this.bounds = null;\r\n                        this.scans = null;\r\n                        this.complexity = 0;\r\n                    }\r\n                } else {\r\n                    this._updateComplexity();\r\n                }\r\n            }\r\n        }\r\n\r\n        Helper.log(\"[emf] Region subtraction -> \" + this.toString());\r\n    }\r\n\r\n    public intersect(rect: RectL): void {\r\n        Helper.log(\"[emf] Region \" + this.toString() + \" intersect with \" + rect.toString());\r\n        if (this.bounds != null) {\r\n            this.bounds = this.bounds.intersect(rect);\r\n            if (this.bounds != null) {\r\n                if (this.scans != null) {\r\n                    let si = 0;\r\n                    // Remove any scans that are entirely above the new bounds.top\r\n                    while (si < this.scans.length) {\r\n                        const scan = this.scans[si];\r\n                        if (scan.bottom < this.bounds.top) {\r\n                            si++;\r\n                        } else {\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (si > 0) {\r\n                        Helper.log(\"[emf] Region remove \" + si + \" scans from top\");\r\n                        this.scans.splice(0, si);\r\n\r\n                        // Adjust the first scan's top to match the new bounds.top\r\n                        if (this.scans.length > 0) {\r\n                            this.scans[0].top = this.bounds.top;\r\n                        }\r\n                    }\r\n\r\n                    // Get rid of anything that falls outside the new bounds.left/bounds.right\r\n                    si = 0;\r\n                    while (si < this.scans.length) {\r\n                        const scan = this.scans[si];\r\n                        if (scan.top > this.bounds.bottom) {\r\n                            // Remove this and all remaining scans that fall entirely below the new bounds.bottom\r\n                            Helper.log(\"[emf] Region remove \" + (this.scans.length - si) + \" scans from bottom\");\r\n                            this.scans.splice(si, this.scans.length - si);\r\n                            break;\r\n                        }\r\n                        if (!scan.intersect(this.bounds.left, this.bounds.right)) {\r\n                            // Remove now empty scan\r\n                            Helper.log(\"[emf] Region remove now empty scan \" + si + \" due to intersection\");\r\n                            this.scans.splice(si, 1);\r\n                            continue;\r\n                        }\r\n                        si++;\r\n                    }\r\n\r\n                    // If there are any scans left, adjust the last one's bottom to the new bounds.bottom\r\n                    if (this.scans.length > 0) {\r\n                        this.scans[this.scans.length - 1].bottom = this.bounds.bottom;\r\n                    }\r\n\r\n                    this._updateComplexity();\r\n                }\r\n            } else {\r\n                this.scans = null;\r\n                this.complexity = 0;\r\n            }\r\n        }\r\n        Helper.log(\"[emf] Region intersection -> \" + this.toString());\r\n    }\r\n\r\n    public offset(offX: number, offY: number): void {\r\n        if (this.bounds != null) {\r\n            this.bounds.left += offX;\r\n            this.bounds.top += offY;\r\n            this.bounds.right += offX;\r\n            this.bounds.bottom += offY;\r\n        }\r\n\r\n        if (this.scans != null) {\r\n            const slen = this.scans.length;\r\n            for (let si = 0; si < slen; si++) {\r\n                const scan = this.scans[si];\r\n                scan.top += offY;\r\n                scan.bottom += offY;\r\n\r\n                const len = scan.scanlines.length;\r\n                for (let i = 0; i < len; i++) {\r\n                    const scanline = scan.scanlines[i];\r\n                    scanline.left += offX;\r\n                    scanline.right += offX;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function CreateSimpleRegion(left: number, top: number, right: number, bottom: number): Region {\r\n    const rgn = new Region(null, null);\r\n    rgn.bounds = new RectL(null, left, top, right, bottom);\r\n    rgn._updateComplexity();\r\n    return rgn;\r\n}\r\n\r\nexport class Scan {\r\n    public top: number;\r\n    public bottom: number;\r\n    public scanlines: { left: number, right: number }[];\r\n\r\n    constructor(r: RectL, copy?: Scan) {\r\n        if (r != null) {\r\n            this.top = r.top;\r\n            this.bottom = r.bottom;\r\n            this.scanlines = [{left: r.left, right: r.right}];\r\n        } else if (copy != null) {\r\n            this.top = copy.top;\r\n            this.bottom = copy.bottom;\r\n            this.scanlines = [];\r\n            for (let i = 0; i < copy.scanlines.length; i++) {\r\n                const scanline = copy.scanlines[i];\r\n                this.scanlines.push({left: scanline.left, right: scanline.right});\r\n            }\r\n        }\r\n    }\r\n\r\n    public clone(): Scan {\r\n        return new Scan(null, this);\r\n    }\r\n\r\n    public append(r: RectL): void {\r\n        this.scanlines.push({left: r.left, right: r.right});\r\n    }\r\n\r\n    public subtract(left: number, right: number): boolean {\r\n        let i;\r\n\r\n        // Keep everything on the left side\r\n        i = 0;\r\n        while (i < this.scanlines.length) {\r\n            const scanline = this.scanlines[i];\r\n            if (scanline.left <= left) {\r\n                if (scanline.right >= left) {\r\n                    scanline.right = left - 1;\r\n                    if (scanline.left >= scanline.right) {\r\n                        this.scanlines.splice(i, 1);\r\n                        continue;\r\n                    }\r\n                }\r\n                i++;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        // Find the first one that may exceed to the right side\r\n        const first = i;\r\n        let cnt = 0;\r\n        while (i < this.scanlines.length) {\r\n            const scanline = this.scanlines[i];\r\n            if (scanline.right > right) {\r\n                scanline.left = right;\r\n                cnt = i - first;\r\n                if (scanline.left >= scanline.right) {\r\n                    cnt++;\r\n                }\r\n                break;\r\n            }\r\n            i++;\r\n        }\r\n\r\n        // Delete everything we're subtracting\r\n        if (cnt > 0 && first < this.scanlines.length) {\r\n            this.scanlines.splice(first, cnt);\r\n        }\r\n\r\n        return this.scanlines.length > 0;\r\n    }\r\n\r\n    public intersect(left: number, right: number): boolean {\r\n        // Get rid of anything that falls entirely outside to the left\r\n        for (let i = 0; i < this.scanlines.length; i++) {\r\n            const scanline = this.scanlines[i];\r\n            if (scanline.left >= left || scanline.right >= left) {\r\n                if (i > 0) {\r\n                    this.scanlines.splice(0, i);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (this.scanlines.length > 0) {\r\n            // Adjust the first to match the left, if needed\r\n            let scanline = this.scanlines[0];\r\n            if (scanline.left < left) {\r\n                scanline.left = left;\r\n            }\r\n\r\n            // Get rid of anything that falls entirely outside to the right\r\n            for (let i = 0; i < this.scanlines.length; i++) {\r\n                scanline = this.scanlines[i];\r\n                if (scanline.left > right) {\r\n                    this.scanlines.splice(i, this.scanlines.length - i);\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (this.scanlines.length > 0) {\r\n                // Adjust the last to match the right, if needed\r\n                scanline = this.scanlines[this.scanlines.length - 1];\r\n                if (scanline.right > right) {\r\n                    scanline.right = right;\r\n                }\r\n            }\r\n        }\r\n        return this.scanlines.length > 0;\r\n    }\r\n}\r\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2016 Tom Zoehner\r\nCopyright (c) 2018 Thomas Bluemel\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nimport { DIBitmap } from \"./Bitmap\";\r\nimport { Blob } from \"./Blob\";\r\nimport { Helper } from \"./Helper\";\r\nimport { Obj, PointL } from \"./Primitives\";\r\n\r\nexport class ColorRef {\r\n    public r: number;\r\n    public g: number;\r\n    public b: number;\r\n\r\n    constructor(reader: Blob, r?: number, g?: number, b?: number) {\r\n        if (reader != null) {\r\n            this.r = reader.readUint8();\r\n            this.g = reader.readUint8();\r\n            this.b = reader.readUint8();\r\n            reader.skip(1);\r\n        } else {\r\n            this.r = r;\r\n            this.g = g;\r\n            this.b = b;\r\n        }\r\n    }\r\n\r\n    public clone(): ColorRef {\r\n        return new ColorRef(null, this.r, this.g, this.b);\r\n    }\r\n\r\n    public toHex(): string {\r\n        const rgb = (this.r << 16) | (this.g << 8) | this.b;\r\n        return (0x1000000 + rgb).toString(16).slice(1);\r\n    }\r\n\r\n    public toString(): string {\r\n        return \"{r: \" + this.r + \", g: \" + this.g + \", b: \" + this.b + \"}\";\r\n    }\r\n}\r\n\r\nexport class Font extends Obj {\r\n    public height: number;\r\n    public width: number;\r\n    public escapement: number;\r\n    public orientation: number;\r\n    public weight: number;\r\n    public italic: number;\r\n    public underline: number;\r\n    public strikeout: number;\r\n    public charset: number;\r\n    public outprecision: number;\r\n    public clipprecision: number;\r\n    public quality: number;\r\n    public pitch: number;\r\n    public family: number;\r\n    public facename: string;\r\n\r\n    constructor(reader: Blob, copy: Font | number) {\r\n        super(\"font\");\r\n        if (reader != null) {\r\n            this.height = reader.readInt32();\r\n            this.width = reader.readInt32();\r\n            this.escapement = reader.readInt32();\r\n            this.orientation = reader.readInt32();\r\n            this.weight = reader.readInt32();\r\n            this.italic = reader.readUint8();\r\n            this.underline = reader.readUint8();\r\n            this.strikeout = reader.readUint8();\r\n            this.charset = reader.readUint8();\r\n            this.outprecision = reader.readUint8();\r\n            this.clipprecision = reader.readUint8();\r\n            this.quality = reader.readUint8();\r\n            const pitchAndFamily = reader.readUint8();\r\n            this.pitch = pitchAndFamily & 0xf; // TODO: double check\r\n            this.family = (pitchAndFamily >> 6) & 0x3; // TODO: double check\r\n\r\n            const dataLength = copy as number;\r\n            const start = reader.pos;\r\n            this.facename = reader.readFixedSizeUnicodeString(Math.min(dataLength - (reader.pos - start), 32));\r\n        } else if (copy != null) {\r\n            copy = copy as Font;\r\n            this.height = copy.height;\r\n            this.width = copy.width;\r\n            this.escapement = copy.escapement;\r\n            this.orientation = copy.orientation;\r\n            this.weight = copy.weight;\r\n            this.italic = copy.italic;\r\n            this.underline = copy.underline;\r\n            this.strikeout = copy.strikeout;\r\n            this.charset = copy.charset;\r\n            this.outprecision = copy.outprecision;\r\n            this.clipprecision = copy.clipprecision;\r\n            this.quality = copy.quality;\r\n            this.pitch = copy.pitch;\r\n            this.family = copy.family;\r\n            this.facename = copy.facename;\r\n        } else {\r\n            // TODO: Values for a default font?\r\n            this.height = -80;\r\n            this.width = 0;\r\n            this.escapement = 0;\r\n            this.orientation = 0;\r\n            this.weight = 400;\r\n            this.italic = 0;\r\n            this.underline = 0;\r\n            this.strikeout = 0;\r\n            this.charset = 0;\r\n            this.outprecision = 0;\r\n            this.clipprecision = 0;\r\n            this.quality = 0;\r\n            this.pitch = 0;\r\n            this.family = 0;\r\n            this.facename = \"Helvetica\";\r\n        }\r\n    }\r\n\r\n    public clone(): Font {\r\n        return new Font(null, this);\r\n    }\r\n\r\n    public toString(): string {\r\n        return JSON.stringify(this);\r\n    }\r\n}\r\n\r\nexport class Brush extends Obj {\r\n    public style: number;\r\n    public color: ColorRef;\r\n    public pattern: DIBitmap;\r\n    public dibpatternpt: DIBitmap;\r\n    public hatchstyle: number;\r\n\r\n    constructor(reader: Blob, copy?: {\r\n        style?: number, color?: ColorRef, pattern?: DIBitmap,\r\n        dibpatternpt?: DIBitmap, hatchstyle?: number\r\n    }) {\r\n        super(\"brush\");\r\n        if (reader != null) {\r\n            const start = reader.pos;\r\n\r\n            this.style = reader.readUint32();\r\n            switch (this.style) {\r\n                case Helper.GDI.BrushStyle.BS_SOLID:\r\n                    this.color = new ColorRef(reader);\r\n                    break;\r\n                case Helper.GDI.BrushStyle.BS_PATTERN:\r\n                    this.pattern = new DIBitmap(reader);\r\n                    break;\r\n                case Helper.GDI.BrushStyle.BS_DIBPATTERNPT:\r\n                    this.dibpatternpt = new DIBitmap(reader);\r\n                    break;\r\n                case Helper.GDI.BrushStyle.BS_HATCHED:\r\n                    this.color = new ColorRef(reader);\r\n                    this.hatchstyle = reader.readUint32();\r\n                    break;\r\n            }\r\n\r\n            reader.seek(start + 12);\r\n        } else {\r\n            this.style = copy.style;\r\n            switch (this.style) {\r\n                case Helper.GDI.BrushStyle.BS_SOLID:\r\n                    this.color = copy.color.clone();\r\n                    break;\r\n                case Helper.GDI.BrushStyle.BS_PATTERN:\r\n                    this.pattern = copy.pattern;\r\n                    break;\r\n                case Helper.GDI.BrushStyle.BS_DIBPATTERNPT:\r\n                    this.dibpatternpt = copy.dibpatternpt;\r\n                    break;\r\n                case Helper.GDI.BrushStyle.BS_HATCHED:\r\n                    this.color = copy.color.clone();\r\n                    this.hatchstyle = copy.hatchstyle;\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    public clone(): Brush {\r\n        return new Brush(null, this);\r\n    }\r\n\r\n    public toString(): string {\r\n        let ret = \"{style: \" + this.style;\r\n        switch (this.style) {\r\n            case Helper.GDI.BrushStyle.BS_SOLID:\r\n                ret += \", color: \" + this.color.toString();\r\n                break;\r\n            case Helper.GDI.BrushStyle.BS_HATCHED:\r\n                ret += \", color: \" + this.color.toString() + \", hatchstyle: \" + this.hatchstyle;\r\n                break;\r\n        }\r\n        return ret + \"}\";\r\n    }\r\n}\r\n\r\nexport class Pen extends Obj {\r\n    public style: number | { header: { off: number, size: number }, data: { off: number, size: number } };\r\n    public width: number;\r\n    public brush: Brush;\r\n    public color: ColorRef;\r\n\r\n    constructor(reader: Blob, style?: number | { header: { off: number, size: number }, data: { off: number, size: number } },\r\n                width?: number, color?: ColorRef, brush?: Brush) {\r\n        super(\"pen\");\r\n        if (reader != null) {\r\n            if (style != null) {\r\n                // LogPenEx\r\n                this.style = reader.readUint32() & 0xFF;\r\n                this.width = reader.readUint32();\r\n                this.brush = new Brush(reader);\r\n                this.color = this.brush.color != null ? this.brush.color.clone() : new ColorRef(null, 0, 0, 0);\r\n                // TODO: NumStyleEntries, StyleEntry\r\n            } else {\r\n                // LogPen\r\n                this.style = reader.readUint32() & 0xFF;\r\n                this.width = (new PointL(reader)).x;\r\n                this.color = new ColorRef(reader);\r\n            }\r\n        } else {\r\n            this.style = style;\r\n            this.width = width;\r\n            if (color != null) {\r\n                this.color = color;\r\n            }\r\n            if (brush != null) {\r\n                this.brush = brush;\r\n            }\r\n        }\r\n    }\r\n\r\n    public clone(): Pen {\r\n        return new Pen(null, this.style, this.width, this.color != null ? this.color.clone() : null,\r\n            this.brush != null ? this.brush.clone() : null);\r\n    }\r\n\r\n    public toString(): string {\r\n        return \"{style: \" + this.style + \", width: \" + this.width\r\n            + \", color: \" + (this.color != null ? this.color.toString() : \"none\") + \"}\";\r\n    }\r\n}\r\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2016 Tom Zoehner\r\nCopyright (c) 2018 Thomas Bluemel\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nimport { Blob } from \"./Blob\";\r\nimport { Helper } from \"./Helper\";\r\n\r\ninterface Bitmap {\r\n    getWidth(): number\r\n\r\n    getHeight(): number\r\n}\r\n\r\nclass BitmapCoreHeader {\r\n    public width: number;\r\n    public height: number;\r\n    public planes: number;\r\n    public bitcount: number;\r\n\r\n    constructor(reader: Blob, skipsize: boolean) {\r\n        if (skipsize) {\r\n            reader.skip(4);\r\n        }\r\n        this.width = reader.readUint16();\r\n        this.height = reader.readUint16();\r\n        this.planes = reader.readUint16();\r\n        this.bitcount = reader.readUint16();\r\n    }\r\n\r\n    public colors(): number {\r\n        return this.bitcount <= 8 ? 1 << this.bitcount : 0;\r\n    }\r\n}\r\n\r\nclass BitmapInfoHeader {\r\n    public width: number;\r\n    public height: number;\r\n    public planes: number;\r\n    public bitcount: number;\r\n    public compression: number;\r\n    public sizeimage: number;\r\n    public xpelspermeter: number;\r\n    public ypelspermeter: number;\r\n    public clrused: number;\r\n    public clrimportant: number;\r\n\r\n    constructor(reader: Blob, skipsize: boolean) {\r\n        if (skipsize) {\r\n            reader.skip(4);\r\n        }\r\n        this.width = reader.readInt32();\r\n        this.height = reader.readInt32();\r\n        this.planes = reader.readUint16();\r\n        this.bitcount = reader.readUint16();\r\n        this.compression = reader.readUint32();\r\n        this.sizeimage = reader.readUint32();\r\n        this.xpelspermeter = reader.readInt32();\r\n        this.ypelspermeter = reader.readInt32();\r\n        this.clrused = reader.readUint32();\r\n        this.clrimportant = reader.readUint32();\r\n    }\r\n\r\n    public colors(): number {\r\n        if (this.clrused !== 0) {\r\n            return this.clrused < 256 ? this.clrused : 256;\r\n        } else {\r\n            return this.bitcount > 8 ? 0 : 1 << this.bitcount;\r\n        }\r\n    }\r\n}\r\n\r\nexport class BitmapInfo implements Bitmap {\r\n    private _usergb: boolean;\r\n    private _infosize: number;\r\n    private _header: BitmapCoreHeader | BitmapInfoHeader;\r\n\r\n    constructor(reader: Blob, usergb: boolean) {\r\n        this._usergb = usergb;\r\n        const hdrsize = reader.readUint32();\r\n        this._infosize = hdrsize;\r\n        if (hdrsize === Helper.GDI.BITMAPCOREHEADER_SIZE) {\r\n            this._header = new BitmapCoreHeader(reader, false);\r\n            this._infosize += this._header.colors() * (usergb ? 3 : 2);\r\n        } else {\r\n            this._header = new BitmapInfoHeader(reader, false);\r\n            const masks = (this._header as BitmapInfoHeader).compression\r\n            === Helper.GDI.BitmapCompression.BI_BITFIELDS ? 3 : 0;\r\n            if (hdrsize <= Helper.GDI.BITMAPINFOHEADER_SIZE + (masks * 4)) {\r\n                this._infosize = Helper.GDI.BITMAPINFOHEADER_SIZE + (masks * 4);\r\n            }\r\n            this._infosize += this._header.colors() * (usergb ? 4 : 2);\r\n        }\r\n    }\r\n\r\n    public getWidth(): number {\r\n        return this._header.width;\r\n    }\r\n\r\n    public getHeight(): number {\r\n        return Math.abs(this._header.height);\r\n    }\r\n\r\n    public infosize(): number {\r\n        return this._infosize;\r\n    }\r\n\r\n    public header(): BitmapCoreHeader | BitmapInfoHeader {\r\n        return this._header;\r\n    }\r\n}\r\n\r\nexport class DIBitmap implements Bitmap {\r\n    private _reader: Blob;\r\n    private _offset: number;\r\n    private _location: any;\r\n    private _info: BitmapInfo;\r\n\r\n    constructor(reader: Blob, bitmapInfo?: any) {\r\n        this._reader = reader;\r\n        this._offset = reader.pos;\r\n        this._location = bitmapInfo;\r\n        this._info = new BitmapInfo(reader, true);\r\n    }\r\n\r\n    public getWidth(): number {\r\n        return this._info.getWidth();\r\n    }\r\n\r\n    public getHeight(): number {\r\n        return this._info.getHeight();\r\n    }\r\n\r\n    public totalSize(): number {\r\n        return this._location.header.size + this._location.data.size;\r\n    }\r\n\r\n    public makeBitmapFileHeader(): string {\r\n        const buf = new ArrayBuffer(14);\r\n        const view = new Uint8Array(buf);\r\n        view[0] = 0x42;\r\n        view[1] = 0x4d;\r\n        Helper._writeUint32Val(view, 2, this.totalSize() + 14);\r\n        Helper._writeUint32Val(view, 10, this._info.infosize() + 14);\r\n        return Helper._blobToBinary(view);\r\n    }\r\n\r\n    public base64ref(): string {\r\n        const prevpos = this._reader.pos;\r\n        this._reader.seek(this._offset);\r\n        let mime = \"image/bmp\";\r\n        const header = this._info.header();\r\n        let data;\r\n        if (header instanceof BitmapInfoHeader && header.compression != null) {\r\n            switch (header.compression) {\r\n                case Helper.GDI.BitmapCompression.BI_JPEG:\r\n                    mime = \"data:image/jpeg\";\r\n                    break;\r\n                case Helper.GDI.BitmapCompression.BI_PNG:\r\n                    mime = \"data:image/png\";\r\n                    break;\r\n                default:\r\n                    data = this.makeBitmapFileHeader();\r\n                    break;\r\n            }\r\n        } else {\r\n            data = this.makeBitmapFileHeader();\r\n        }\r\n\r\n        this._reader.seek(this._location.header.offset);\r\n        if (data != null) {\r\n            data += this._reader.readBinary(this._location.header.size);\r\n        } else {\r\n            data = this._reader.readBinary(this._location.header.size);\r\n        }\r\n\r\n        this._reader.seek(this._location.data.offset);\r\n        data += this._reader.readBinary(this._location.data.size);\r\n\r\n        const ref = \"data:\" + mime + \";base64,\" + btoa(data);\r\n        this._reader.seek(prevpos);\r\n        return ref;\r\n    }\r\n}\r\n","/*\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2016 Tom Zoehner\r\nCopyright (c) 2018 Thomas Bluemel\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n\r\n*/\r\n\r\nimport { SVG } from \"../util\";\r\nimport { SVGPathBuilder } from \"../util/SVG\";\r\nimport { EMFJSError, Helper } from \"./Helper\";\r\nimport { Obj, PointL, PointS, RectL } from \"./Primitives\";\r\nimport { CreateSimpleRegion, Region } from \"./Region\";\r\nimport { Brush, ColorRef, Font, Pen } from \"./Style\";\r\n\r\ninterface ISelectedStyle {\r\n    brush?: Brush;\r\n    pen?: Pen;\r\n    font?: Font;\r\n    region?: Region;\r\n    path?: Path;\r\n\r\n    [key: string]: Obj | undefined;\r\n}\r\n\r\nclass Path extends Obj {\r\n    public svgPath: SVGPathBuilder;\r\n\r\n    constructor(svgPath: SVGPathBuilder, copy?: Path) {\r\n        super(\"path\");\r\n        if (svgPath != null) {\r\n            this.svgPath = svgPath;\r\n        } else {\r\n            this.svgPath = copy.svgPath;\r\n        }\r\n    }\r\n\r\n    public clone(): Path {\r\n        return new Path(null, this);\r\n    }\r\n\r\n    public toString(): string {\r\n        return \"{[path]}\";\r\n    }\r\n}\r\n\r\nfunction createStockObjects(): { [key: string]: Obj } {\r\n    // Create global stock objects\r\n    const createSolidBrush = (r: number, g: number, b: number) => {\r\n        return new Brush(null, {\r\n            style: Helper.GDI.BrushStyle.BS_SOLID,\r\n            color: new ColorRef(null, r, g, b),\r\n        });\r\n    };\r\n    const createSolidPen = (r: number, g: number, b: number) => {\r\n        return new Pen(null, Helper.GDI.PenStyle.PS_SOLID, 1, new ColorRef(null, r, g, b), null);\r\n    };\r\n    const stockObjs: { [key: string]: Obj } = {\r\n        WHITE_BRUSH: createSolidBrush(255, 255, 255),\r\n        LTGRAY_BRUSH: createSolidBrush(212, 208, 200),\r\n        GRAY_BRUSH: createSolidBrush(128, 128, 128),\r\n        DKGRAY_BRUSH: createSolidBrush(64, 64, 64),\r\n        BLACK_BRUSH: createSolidBrush(0, 0, 0),\r\n        NULL_BRUSH: new Brush(null, {\r\n            style: Helper.GDI.BrushStyle.BS_NULL,\r\n        }),\r\n        WHITE_PEN: createSolidPen(255, 255, 255),\r\n        BLACK_PEN: createSolidPen(0, 0, 0),\r\n        NULL_PEN: new Pen(null, Helper.GDI.PenStyle.PS_NULL, 0, null, null),\r\n        OEM_FIXED_FONT: null, // TODO\r\n        ANSI_FIXED_FONT: null, // TODO\r\n        ANSI_VAR_FONT: null, // TODO\r\n        SYSTEM_FONT: null, // TODO\r\n        DEVICE_DEFAULT_FONT: null, // TODO\r\n        DEFAULT_PALETTE: null, // TODO\r\n        SYSTEM_FIXED_FONT: null, // TODO\r\n        DEFAULT_GUI_FONT: null, // TODO\r\n    };\r\n\r\n    const objs: { [key: string]: Obj } = {};\r\n    for (const t in stockObjs) {\r\n        const stockObjects: { [key: string]: number } = Helper.GDI.StockObject as { [key: string]: number };\r\n        const idx = stockObjects[t] - 0x80000000;\r\n        objs[idx.toString()] = stockObjs[t];\r\n    }\r\n    return objs;\r\n}\r\n\r\nconst _StockObjects = createStockObjects();\r\n\r\nclass GDIContextState {\r\n    public _svggroup: SVGElement;\r\n    public _svgclipChanged: boolean;\r\n    public _svgtextbkfilter: SVGFilterElement;\r\n    public mapmode: number;\r\n    public stretchmode: number;\r\n    public textalign: number;\r\n    public bkmode: number;\r\n    public textcolor: ColorRef;\r\n    public bkcolor: ColorRef;\r\n    public polyfillmode: number;\r\n    public miterlimit: number;\r\n    public wx: number;\r\n    public wy: number;\r\n    public ww: number;\r\n    public wh: number;\r\n    public vx: number;\r\n    public vy: number;\r\n    public vw: number;\r\n    public vh: number;\r\n    public x: number;\r\n    public y: number;\r\n    public nextbrx: number;\r\n    public nextbry: number;\r\n    public brx: number;\r\n    public bry: number;\r\n    public clip: Region;\r\n    public ownclip: boolean;\r\n    public selected: ISelectedStyle;\r\n\r\n    constructor(copy: GDIContextState, defObjects?: ISelectedStyle) {\r\n        if (copy != null) {\r\n            this._svggroup = copy._svggroup;\r\n            this._svgclipChanged = copy._svgclipChanged;\r\n            this._svgtextbkfilter = copy._svgtextbkfilter;\r\n            this.mapmode = copy.mapmode;\r\n            this.stretchmode = copy.stretchmode;\r\n            this.textalign = copy.textalign;\r\n            this.bkmode = copy.bkmode;\r\n            this.textcolor = copy.textcolor.clone();\r\n            this.bkcolor = copy.bkcolor.clone();\r\n            this.polyfillmode = copy.polyfillmode;\r\n            this.miterlimit = copy.miterlimit;\r\n            this.wx = copy.wx;\r\n            this.wy = copy.wy;\r\n            this.ww = copy.ww;\r\n            this.wh = copy.wh;\r\n            this.vx = copy.vx;\r\n            this.vy = copy.vy;\r\n            this.vw = copy.vw;\r\n            this.vh = copy.vh;\r\n            this.x = copy.x;\r\n            this.y = copy.y;\r\n            this.nextbrx = copy.nextbrx;\r\n            this.nextbry = copy.nextbry;\r\n            this.brx = copy.brx;\r\n            this.bry = copy.bry;\r\n\r\n            this.clip = copy.clip;\r\n            this.ownclip = false;\r\n\r\n            this.selected = {};\r\n            for (const type in copy.selected) {\r\n                this.selected[type] = copy.selected[type];\r\n            }\r\n        } else {\r\n            this._svggroup = null;\r\n            this._svgclipChanged = false;\r\n            this._svgtextbkfilter = null;\r\n            this.mapmode = Helper.GDI.MapMode.MM_ANISOTROPIC;\r\n            this.stretchmode = Helper.GDI.StretchMode.COLORONCOLOR;\r\n            this.textalign = 0; // TA_LEFT | TA_TOP | TA_NOUPDATECP\r\n            this.bkmode = Helper.GDI.MixMode.OPAQUE;\r\n            this.textcolor = new ColorRef(null, 0, 0, 0);\r\n            this.bkcolor = new ColorRef(null, 255, 255, 255);\r\n            this.polyfillmode = Helper.GDI.PolygonFillMode.ALTERNATE;\r\n            this.miterlimit = 10;\r\n            this.wx = 0;\r\n            this.wy = 0;\r\n            this.ww = 0;\r\n            this.wh = 0;\r\n            this.vx = 0;\r\n            this.vy = 0;\r\n            this.vw = 0;\r\n            this.vh = 0;\r\n            this.x = 0;\r\n            this.y = 0;\r\n            this.nextbrx = 0;\r\n            this.nextbry = 0;\r\n            this.brx = 0;\r\n            this.bry = 0;\r\n\r\n            this.clip = null;\r\n            this.ownclip = false;\r\n\r\n            this.selected = {};\r\n            for (const type in defObjects) {\r\n                const defObj = defObjects[type];\r\n                this.selected[type] = defObj != null ? defObj.clone() : null;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class GDIContext {\r\n    private _svg: SVG;\r\n    private _svgdefs: SVGDefsElement;\r\n    private _svgPatterns: { [key: string]: Brush };\r\n    private _svgClipPaths: { [key: string]: Region };\r\n    private _svgPath: SVGPathBuilder;\r\n    private defObjects: ISelectedStyle;\r\n    private state: GDIContextState;\r\n    private statestack: GDIContextState[];\r\n    private objects: { [key: string]: Obj };\r\n\r\n    constructor(svg: SVG) {\r\n        this._svg = svg;\r\n        this._svgdefs = null;\r\n        this._svgPatterns = {};\r\n        this._svgClipPaths = {};\r\n        this._svgPath = null;\r\n\r\n        this.defObjects = {\r\n            brush: new Brush(null, {\r\n                style: Helper.GDI.BrushStyle.BS_SOLID,\r\n                color: new ColorRef(null, 0, 0, 0),\r\n            }),\r\n            pen: new Pen(null, Helper.GDI.PenStyle.PS_SOLID, 1, new ColorRef(null, 0, 0, 0), null),\r\n            font: new Font(null, null),\r\n            palette: null,\r\n            region: null,\r\n        };\r\n\r\n        this.state = new GDIContextState(null, this.defObjects);\r\n        this.statestack = [this.state];\r\n        this.objects = {};\r\n    }\r\n\r\n    public setMapMode(mode: number): void {\r\n        Helper.log(\"[gdi] setMapMode: mode=\" + mode);\r\n        this.state.mapmode = mode;\r\n        this.state._svggroup = null;\r\n    }\r\n\r\n    public setWindowOrgEx(x: number, y: number): void {\r\n        Helper.log(\"[gdi] setWindowOrgEx: x=\" + x + \" y=\" + y);\r\n        this.state.wx = x;\r\n        this.state.wy = y;\r\n        this.state._svggroup = null;\r\n    }\r\n\r\n    public setWindowExtEx(x: number, y: number): void {\r\n        Helper.log(\"[gdi] setWindowExtEx: x=\" + x + \" y=\" + y);\r\n        this.state.ww = x;\r\n        this.state.wh = y;\r\n        this.state._svggroup = null;\r\n    }\r\n\r\n    public setViewportOrgEx(x: number, y: number): void {\r\n        Helper.log(\"[gdi] setViewportOrgEx: x=\" + x + \" y=\" + y);\r\n        this.state.vx = x;\r\n        this.state.vy = y;\r\n        this.state._svggroup = null;\r\n    }\r\n\r\n    public setViewportExtEx(x: number, y: number): void {\r\n        Helper.log(\"[gdi] setViewportExtEx: x=\" + x + \" y=\" + y);\r\n        this.state.vw = x;\r\n        this.state.vh = y;\r\n        this.state._svggroup = null;\r\n    }\r\n\r\n    public setBrushOrgEx(origin: PointL): void {\r\n        Helper.log(\"[gdi] setBrushOrgEx: x=\" + origin.x + \" y=\" + origin.y);\r\n        this.state.nextbrx = origin.x;\r\n        this.state.nextbry = origin.y;\r\n    }\r\n\r\n    public saveDC(): void {\r\n        Helper.log(\"[gdi] saveDC\");\r\n        const prevstate = this.state;\r\n        this.state = new GDIContextState(this.state);\r\n        this.statestack.push(prevstate);\r\n        this.state._svggroup = null;\r\n    }\r\n\r\n    public restoreDC(saved: number): void {\r\n        Helper.log(\"[gdi] restoreDC: saved=\" + saved);\r\n        if (this.statestack.length > 1) {\r\n            if (saved === -1) {\r\n                this.state = this.statestack.pop();\r\n            } else if (saved < -1) {\r\n                throw new EMFJSError(\"restoreDC: relative restore not implemented\");\r\n            } else if (saved > 1) {\r\n                throw new EMFJSError(\"restoreDC: absolute restore not implemented\");\r\n            }\r\n        } else {\r\n            throw new EMFJSError(\"No saved contexts\");\r\n        }\r\n\r\n        this.state._svggroup = null;\r\n    }\r\n\r\n    public setStretchBltMode(stretchMode: number): void {\r\n        Helper.log(\"[gdi] setStretchBltMode: stretchMode=\" + stretchMode);\r\n    }\r\n\r\n    public rectangle(rect: RectL, rw: number, rh: number): void {\r\n        Helper.log(\"[gdi] rectangle: rect=\" + rect.toString() + \" with pen \" + this.state.selected.pen.toString()\r\n            + \" and brush \" + this.state.selected.brush.toString());\r\n        const bottom = this._todevY(rect.bottom);\r\n        const right = this._todevX(rect.right);\r\n        const top = this._todevY(rect.top);\r\n        const left = this._todevX(rect.left);\r\n        rw = this._todevH(rw);\r\n        rh = this._todevH(rh);\r\n        Helper.log(\"[gdi] rectangle: TRANSLATED: bottom=\" + bottom + \" right=\" + right + \" top=\" + top\r\n            + \" left=\" + left + \" rh=\" + rh + \" rw=\" + rw);\r\n        this._pushGroup();\r\n\r\n        const opts = this._applyOpts(null, true, true, false);\r\n        this._svg.rect(this.state._svggroup, left, top, right - left, bottom - top, rw / 2, rh / 2, opts);\r\n    }\r\n\r\n    public lineTo(x: number, y: number): void {\r\n        Helper.log(\"[gdi] lineTo: x=\" + x + \" y=\" + y + \" with pen \" + this.state.selected.pen.toString());\r\n        const toX = this._todevX(x);\r\n        const toY = this._todevY(y);\r\n        const fromX = this._todevX(this.state.x);\r\n        const fromY = this._todevY(this.state.y);\r\n\r\n        // Update position\r\n        this.state.x = x;\r\n        this.state.y = y;\r\n\r\n        Helper.log(\"[gdi] lineTo: TRANSLATED: toX=\" + toX + \" toY=\" + toY + \" fromX=\" + fromX + \" fromY=\" + fromY);\r\n        this._pushGroup();\r\n\r\n        const opts = this._applyOpts(null, true, false, false);\r\n        this._svg.line(this.state._svggroup, fromX, fromY, toX, toY, opts);\r\n    }\r\n\r\n    public moveToEx(x: number, y: number): void {\r\n        Helper.log(\"[gdi] moveToEx: x=\" + x + \" y=\" + y);\r\n        this.state.x = x;\r\n        this.state.y = y;\r\n        if (this._svgPath != null) {\r\n            this._svgPath.move(this.state.x, this.state.y);\r\n            Helper.log(\"[gdi] new path: \" + this._svgPath.path());\r\n        }\r\n    }\r\n\r\n    public polygon(points: PointS[] | PointL[], bounds: RectL, first: boolean): void {\r\n        Helper.log(\"[gdi] polygon: points=\" + points + \" with pen \" + this.state.selected.pen.toString()\r\n            + \" and brush \" + this.state.selected.brush.toString());\r\n        const pts = [];\r\n        for (let i = 0; i < points.length; i++) {\r\n            const point = points[i];\r\n            pts.push([this._todevX(point.x), this._todevY(point.y)]);\r\n        }\r\n        if (first) {\r\n            this._pushGroup();\r\n        }\r\n        const opts = {\r\n            \"fill-rule\": this.state.polyfillmode === Helper.GDI.PolygonFillMode.ALTERNATE ? \"evenodd\" : \"nonzero\",\r\n        };\r\n        this._applyOpts(opts, true, true, false);\r\n        this._svg.polygon(this.state._svggroup, pts, opts);\r\n    }\r\n\r\n    public polyPolygon(polygons: PointS[][] | PointL[][], bounds: RectL): void {\r\n        Helper.log(\"[gdi] polyPolygon: polygons.length=\" + polygons.length\r\n            + \" with pen \" + this.state.selected.pen.toString() + \" and brush \" + this.state.selected.brush.toString());\r\n\r\n        const cnt = polygons.length;\r\n        for (let i = 0; i < cnt; i++) {\r\n            this.polygon(polygons[i], bounds, i === 0);\r\n        }\r\n    }\r\n\r\n    public polyline(isLineTo: boolean, points: PointS[], bounds: RectL): void {\r\n        Helper.log(\"[gdi] polyline: isLineTo=\" + isLineTo.toString() + \", points=\" + points\r\n            + \", bounds=\" + bounds.toString() + \" with pen \" + this.state.selected.pen.toString());\r\n        const pts: number[][] = [];\r\n        for (let i = 0; i < points.length; i++) {\r\n            const point = points[i];\r\n            pts.push([this._todevX(point.x), this._todevY(point.y)]);\r\n        }\r\n\r\n        if (this._svgPath != null) {\r\n            if (!isLineTo || pts.length === 0) {\r\n                this._svgPath.move(this._todevX(this.state.x), this._todevY(this.state.y));\r\n            } else {\r\n                const firstPts = pts[0];\r\n                this._svgPath.move(firstPts[0], firstPts[1]);\r\n            }\r\n            this._svgPath.line(pts);\r\n            Helper.log(\"[gdi] new path: \" + this._svgPath.path());\r\n        } else {\r\n            this._pushGroup();\r\n            const opts = this._applyOpts(null, true, false, false);\r\n            if (isLineTo && points.length > 0) {\r\n                const firstPt = points[0];\r\n                if (firstPt.x !== this.state.x || firstPt.y !== this.state.y) {\r\n                    pts.unshift([this._todevX(this.state.x), this._todevY(this.state.y)]);\r\n                }\r\n            }\r\n            this._svg.polyline(this.state._svggroup, pts, opts);\r\n        }\r\n\r\n        if (points.length > 0) {\r\n            const lastPt = points[points.length - 1];\r\n            this.state.x = lastPt.x;\r\n            this.state.y = lastPt.y;\r\n        }\r\n    }\r\n\r\n    public polybezier(isPolyBezierTo: boolean, points: PointS[], bounds: RectL): void {\r\n        Helper.log(\"[gdi] polybezier: isPolyBezierTo=\" + isPolyBezierTo.toString() + \", points=\" + points\r\n            + \", bounds=\" + bounds.toString() + \" with pen \" + this.state.selected.pen.toString());\r\n        const pts = [];\r\n        for (let i = 0; i < points.length; i++) {\r\n            const point = points[i];\r\n            pts.push({x: this._todevX(point.x), y: this._todevY(point.y)});\r\n        }\r\n\r\n        if (this._svgPath != null) {\r\n            if (isPolyBezierTo && pts.length > 0) {\r\n                const firstPts = pts[0];\r\n                this._svgPath.move(firstPts.x, firstPts.y);\r\n            } else {\r\n                this._svgPath.move(this._todevX(this.state.x), this._todevY(this.state.y));\r\n            }\r\n\r\n            if (pts.length < (isPolyBezierTo ? 3 : 4)) {\r\n                throw new EMFJSError(\"Not enough points to draw bezier\");\r\n            }\r\n\r\n            for (let i = isPolyBezierTo ? 1 : 0; i + 3 <= pts.length; i += 3) {\r\n                const cp1 = pts[i];\r\n                const cp2 = pts[i + 1];\r\n                const ep = pts[i + 2];\r\n                this._svgPath.curveC(cp1.x, cp1.y, cp2.x, cp2.y, ep.x, ep.y);\r\n            }\r\n\r\n            Helper.log(\"[gdi] new path: \" + this._svgPath.path());\r\n        } else {\r\n            throw new EMFJSError(\"polybezier not implemented (not a path)\");\r\n        }\r\n\r\n        if (points.length > 0) {\r\n            const lastPt = points[points.length - 1];\r\n            this.state.x = lastPt.x;\r\n            this.state.y = lastPt.y;\r\n        }\r\n    }\r\n\r\n    public selectClipPath(rgnMode: number): void {\r\n        Helper.log(\"[gdi] selectClipPath: rgnMode=0x\" + rgnMode.toString(16));\r\n    }\r\n\r\n    public selectClipRgn(rgnMode: number, region: Region): void {\r\n        Helper.log(\"[gdi] selectClipRgn: rgnMode=0x\" + rgnMode.toString(16));\r\n        if (rgnMode === Helper.GDI.RegionMode.RGN_COPY) {\r\n            this.state.selected.region = region;\r\n            this.state.clip = null;\r\n            this.state.ownclip = false;\r\n        } else {\r\n            if (region == null) {\r\n                throw new EMFJSError(\"No clip region to select\");\r\n            }\r\n\r\n            throw new EMFJSError(\"Not implemented: rgnMode=0x\" + rgnMode.toString(16));\r\n        }\r\n        this.state._svgclipChanged = true;\r\n    }\r\n\r\n    public offsetClipRgn(offset: PointL): void {\r\n        Helper.log(\"[gdi] offsetClipRgn: offset=\" + offset.toString());\r\n        this._getClipRgn().offset(offset.x, offset.y);\r\n    }\r\n\r\n    public setTextAlign(textAlignmentMode: number): void {\r\n        Helper.log(\"[gdi] setTextAlign: textAlignmentMode=0x\" + textAlignmentMode.toString(16));\r\n        this.state.textalign = textAlignmentMode;\r\n    }\r\n\r\n    public setMiterLimit(miterLimit: number): void {\r\n        Helper.log(\"[gdi] setMiterLimit: miterLimit=\" + miterLimit);\r\n        this.state.miterlimit = miterLimit;\r\n    }\r\n\r\n    public setBkMode(bkMode: number): void {\r\n        Helper.log(\"[gdi] setBkMode: bkMode=0x\" + bkMode.toString(16));\r\n        this.state.bkmode = bkMode;\r\n    }\r\n\r\n    public setBkColor(bkColor: ColorRef): void {\r\n        Helper.log(\"[gdi] setBkColor: bkColor=\" + bkColor.toString());\r\n        this.state.bkcolor = bkColor;\r\n        this.state._svgtextbkfilter = null;\r\n    }\r\n\r\n    public setPolyFillMode(polyFillMode: number): void {\r\n        Helper.log(\"[gdi] setPolyFillMode: polyFillMode=\" + polyFillMode);\r\n        this.state.polyfillmode = polyFillMode;\r\n    }\r\n\r\n    public createBrush(index: number, brush: Brush): void {\r\n        const idx = this._storeObject(brush, index);\r\n        Helper.log(\"[gdi] createBrush: brush=\" + brush.toString() + \" with handle \" + idx);\r\n    }\r\n\r\n    public createPen(index: number, pen: Pen): void {\r\n        const idx = this._storeObject(pen, index);\r\n        Helper.log(\"[gdi] createPen: pen=\" + pen.toString() + \" width handle \" + idx);\r\n    }\r\n\r\n    public createPenEx(index: number, pen: Pen): void {\r\n        const idx = this._storeObject(pen, index);\r\n        Helper.log(\"[gdi] createPenEx: pen=\" + pen.toString() + \" width handle \" + idx);\r\n    }\r\n\r\n    public selectObject(objIdx: number, checkType: string): void {\r\n        const obj = this._getObject(objIdx);\r\n        if (obj != null && (checkType == null || obj.type === checkType)) {\r\n            this._selectObject(obj);\r\n            Helper.log(\"[gdi] selectObject: objIdx=\" + objIdx\r\n                + (obj ? \" selected \" + obj.type + \": \" + obj.toString() : \"[invalid index]\"));\r\n        } else {\r\n            Helper.log(\"[gdi] selectObject: objIdx=\" + objIdx\r\n                + (obj ? \" invalid object type: \" + obj.type : \"[invalid index]\"));\r\n        }\r\n    }\r\n\r\n    public abortPath(): void {\r\n        Helper.log(\"[gdi] abortPath\");\r\n        if (this._svgPath != null) {\r\n            this._svgPath = null;\r\n        }\r\n    }\r\n\r\n    public beginPath(): void {\r\n        Helper.log(\"[gdi] beginPath\");\r\n\r\n        if (this._svgPath != null) {\r\n            this._svgPath = null;\r\n        }\r\n\r\n        this._svgPath = this._svg.createPath();\r\n    }\r\n\r\n    public closeFigure(): void {\r\n        Helper.log(\"[gdi] closeFigure\");\r\n        if (this._svgPath == null) {\r\n            throw new EMFJSError(\"No path bracket: cannot close figure\");\r\n        }\r\n\r\n        this._svgPath.close();\r\n    }\r\n\r\n    public fillPath(bounds: RectL): void {\r\n        Helper.log(\"[gdi] fillPath\");\r\n        if (this.state.selected.path == null) {\r\n            throw new EMFJSError(\"No path selected\");\r\n        }\r\n\r\n        const selPath = this.state.selected.path;\r\n        const opts = this._applyOpts(null, true, true, false);\r\n        this._svg.path(this.state._svggroup, selPath.svgPath, opts);\r\n\r\n        this._pushGroup();\r\n        this.state.selected.path = null;\r\n    }\r\n\r\n    public strokePath(bounds: RectL): void {\r\n        Helper.log(\"[gdi] strokePath\");\r\n        if (this.state.selected.path == null) {\r\n            throw new EMFJSError(\"No path selected\");\r\n        }\r\n\r\n        const selPath = this.state.selected.path;\r\n        const opts = this._applyOpts({fill: \"none\"}, true, false, false);\r\n        this._svg.path(this.state._svggroup, selPath.svgPath, opts);\r\n\r\n        this._pushGroup();\r\n        this.state.selected.path = null;\r\n    }\r\n\r\n    public endPath(): void {\r\n        Helper.log(\"[gdi] endPath\");\r\n        if (this._svgPath == null) {\r\n            throw new EMFJSError(\"No path bracket: cannot end path\");\r\n        }\r\n\r\n        this._pushGroup();\r\n        this._selectObject(new Path(this._svgPath));\r\n        this._svgPath = null;\r\n    }\r\n\r\n    public deleteObject(objIdx: number): void {\r\n        const ret = this._deleteObject(objIdx);\r\n        Helper.log(\"[gdi] deleteObject: objIdx=\" + objIdx + (ret ? \" deleted object\" : \"[invalid index]\"));\r\n    }\r\n\r\n    private _pushGroup(): void {\r\n        if (this.state._svggroup == null || this.state._svgclipChanged) {\r\n            this.state._svgclipChanged = false;\r\n            this.state._svgtextbkfilter = null;\r\n\r\n            const settings: any = {\r\n                viewBox: [this.state.vx, this.state.vy, this.state.vw, this.state.vh].join(\" \"),\r\n                preserveAspectRatio: \"none\",\r\n            };\r\n            if (this.state.clip != null) {\r\n                Helper.log(\"[gdi] new svg x=\" + this.state.vx + \" y=\" + this.state.vy + \" width=\" + this.state.vw\r\n                    + \" height=\" + this.state.vh + \" with clipping\");\r\n                settings[\"clip-path\"] = \"url(#\" + this._getSvgClipPathForRegion(this.state.clip) + \")\";\r\n            } else {\r\n                Helper.log(\"[gdi] new svg x=\" + this.state.vx + \" y=\" + this.state.vy + \" width=\" + this.state.vw\r\n                    + \" height=\" + this.state.vh + \" without clipping\");\r\n            }\r\n            this.state._svggroup = this._svg.svg(this.state._svggroup,\r\n                this.state.vx, this.state.vy, this.state.vw, this.state.vh, settings);\r\n        }\r\n    }\r\n\r\n    private _getStockObject(idx: number) {\r\n        if (idx >= 0x80000000 && idx <= 0x80000011) {\r\n            return _StockObjects[(idx - 0x80000000).toString()];\r\n        } else if (idx === Helper.GDI.StockObject.DC_BRUSH) {\r\n            return this.state.selected.brush;\r\n        } else if (idx === Helper.GDI.StockObject.DC_PEN) {\r\n            return this.state.selected.pen;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private _storeObject(obj: Obj, idx: number) {\r\n        if (!idx) {\r\n            idx = 0;\r\n            while (this.objects[idx.toString()] != null && idx <= 65535) {\r\n                idx++;\r\n            }\r\n            if (idx > 65535) {\r\n                Helper.log(\"[gdi] Too many objects!\");\r\n                return -1;\r\n            }\r\n        }\r\n\r\n        this.objects[idx.toString()] = obj;\r\n        return idx;\r\n    }\r\n\r\n    private _getObject(objIdx: number) {\r\n        let obj = this.objects[objIdx.toString()];\r\n        if (obj == null) {\r\n            obj = this._getStockObject(objIdx);\r\n            if (obj == null) {\r\n                Helper.log(\"[gdi] No object with handle \" + objIdx);\r\n            }\r\n        }\r\n        return obj;\r\n    }\r\n\r\n    private _getSvgDef() {\r\n        if (this._svgdefs == null) {\r\n            this._svgdefs = this._svg.defs();\r\n        }\r\n        return this._svgdefs;\r\n    }\r\n\r\n    private _getSvgClipPathForRegion(region: Region) {\r\n        for (const existingId in this._svgClipPaths) {\r\n            const rgn = this._svgClipPaths[existingId];\r\n            if (rgn === region) {\r\n                return existingId;\r\n            }\r\n        }\r\n\r\n        const id = Helper._makeUniqueId(\"c\");\r\n        const sclip = this._svg.clipPath(this._getSvgDef(), id, \"userSpaceOnUse\");\r\n        switch (region.complexity) {\r\n            case 1:\r\n                this._svg.rect(sclip,\r\n                    this._todevX(region.bounds.left),\r\n                    this._todevY(region.bounds.top),\r\n                    this._todevW(region.bounds.right - region.bounds.left),\r\n                    this._todevH(region.bounds.bottom - region.bounds.top),\r\n                    {\"fill\": \"black\", \"stroke-width\": 0});\r\n                break;\r\n            case 2:\r\n                for (let i = 0; i < region.scans.length; i++) {\r\n                    const scan = region.scans[i];\r\n                    for (let j = 0; j < scan.scanlines.length; j++) {\r\n                        const scanline = scan.scanlines[j];\r\n                        this._svg.rect(sclip, this._todevX(scanline.left), this._todevY(scan.top),\r\n                            this._todevW(scanline.right - scanline.left), this._todevH(scan.bottom - scan.top),\r\n                            {\"fill\": \"black\", \"stroke-width\": 0});\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n        this._svgClipPaths[id] = region;\r\n        return id;\r\n    }\r\n\r\n    private _getSvgPatternForBrush(brush: Brush) {\r\n        for (const existingId in this._svgPatterns) {\r\n            const pat = this._svgPatterns[existingId];\r\n            if (pat === brush) {\r\n                return existingId;\r\n            }\r\n        }\r\n\r\n        let width;\r\n        let height;\r\n        let img;\r\n        switch (brush.style) {\r\n            case Helper.GDI.BrushStyle.BS_PATTERN:\r\n                width = brush.pattern.getWidth();\r\n                height = brush.pattern.getHeight();\r\n                break;\r\n            case Helper.GDI.BrushStyle.BS_DIBPATTERNPT:\r\n                width = brush.dibpatternpt.getWidth();\r\n                height = brush.dibpatternpt.getHeight();\r\n                img = brush.dibpatternpt.base64ref();\r\n                break;\r\n            default:\r\n                throw new EMFJSError(\"Invalid brush style\");\r\n        }\r\n\r\n        const id = Helper._makeUniqueId(\"p\");\r\n        const spat = this._svg.pattern(this._getSvgDef(), id, this.state.brx, this.state.bry, width, height,\r\n            {patternUnits: \"userSpaceOnUse\"});\r\n        this._svg.image(spat, 0, 0, width, height, img);\r\n        this._svgPatterns[id] = brush;\r\n        return id;\r\n    }\r\n\r\n    private _selectObject(obj: Obj) {\r\n        this.state.selected[obj.type] = obj;\r\n        switch (obj.type) {\r\n            case \"region\":\r\n                this.state._svgclipChanged = true;\r\n                break;\r\n            case \"brush\":\r\n                this.state.brx = this.state.nextbrx;\r\n                this.state.bry = this.state.nextbry;\r\n                break;\r\n        }\r\n    }\r\n\r\n    private _deleteObject(objIdx: number) {\r\n        const obj = this.objects[objIdx.toString()];\r\n        if (obj != null) {\r\n            for (let i = 0; i < this.statestack.length; i++) {\r\n                const state = this.statestack[i];\r\n                if (state.selected[obj.type] === obj) {\r\n                    state.selected[obj.type] = this.defObjects[obj.type].clone();\r\n                }\r\n            }\r\n            delete this.objects[objIdx.toString()];\r\n            return true;\r\n        }\r\n\r\n        Helper.log(\"[gdi] Cannot delete object with invalid handle \" + objIdx);\r\n        return false;\r\n    }\r\n\r\n    private _getClipRgn() {\r\n        if (this.state.clip != null) {\r\n            if (!this.state.ownclip) {\r\n                this.state.clip = this.state.clip.clone();\r\n            }\r\n        } else {\r\n            if (this.state.selected.region != null) {\r\n                this.state.clip = this.state.selected.region.clone();\r\n            } else {\r\n                this.state.clip = CreateSimpleRegion(this.state.wx, this.state.wy, this.state.wx + this.state.ww,\r\n                    this.state.wy + this.state.wh);\r\n            }\r\n        }\r\n        this.state.ownclip = true;\r\n        return this.state.clip;\r\n    }\r\n\r\n    private _todevX(val: number) {\r\n        // http://wvware.sourceforge.net/caolan/mapmode.html\r\n        // logical -> device\r\n        return Math.floor((val - this.state.wx) * (this.state.vw / this.state.ww)) + this.state.vx;\r\n    }\r\n\r\n    private _todevY(val: number) {\r\n        // http://wvware.sourceforge.net/caolan/mapmode.html\r\n        // logical -> device\r\n        return Math.floor((val - this.state.wy) * (this.state.vh / this.state.wh)) + this.state.vy;\r\n    }\r\n\r\n    private _todevW(val: number) {\r\n        // http://wvware.sourceforge.net/caolan/mapmode.html\r\n        // logical -> device\r\n        return Math.floor(val * (this.state.vw / this.state.ww)) + this.state.vx;\r\n    }\r\n\r\n    private _todevH(val: number) {\r\n        // http://wvware.sourceforge.net/caolan/mapmode.html\r\n        // logical -> device\r\n        return Math.floor(val * (this.state.vh / this.state.wh)) + this.state.vy;\r\n    }\r\n\r\n    private _tologicalX(val: number) {\r\n        // http://wvware.sourceforge.net/caolan/mapmode.html\r\n        // logical -> device\r\n        return Math.floor((val - this.state.vx) / (this.state.vw / this.state.ww)) + this.state.wx;\r\n    }\r\n\r\n    private _tologicalY(val: number) {\r\n        // http://wvware.sourceforge.net/caolan/mapmode.html\r\n        // logical -> device\r\n        return Math.floor((val - this.state.vy) / (this.state.vh / this.state.wh)) + this.state.wy;\r\n    }\r\n\r\n    private _tologicalW(val: number) {\r\n        // http://wvware.sourceforge.net/caolan/mapmode.html\r\n        // logical -> device\r\n        return Math.floor(val / (this.state.vw / this.state.ww)) + this.state.wx;\r\n    }\r\n\r\n    private _tologicalH(val: number) {\r\n        // http://wvware.sourceforge.net/caolan/mapmode.html\r\n        // logical -> device\r\n        return Math.floor(val / (this.state.vh / this.state.wh)) + this.state.wy;\r\n    }\r\n\r\n    private _applyOpts(opts: any, usePen: boolean, useBrush: boolean, useFont: boolean) {\r\n        if (opts == null) {\r\n            opts = {};\r\n        }\r\n        if (usePen) {\r\n            const pen = this.state.selected.pen;\r\n            if (pen.style !== Helper.GDI.PenStyle.PS_NULL) {\r\n                opts.stroke = \"#\" + pen.color.toHex(); // TODO: pen style\r\n                opts[\"stroke-width\"] = pen.width;\r\n\r\n                opts[\"stroke-miterlimit\"] = this.state.miterlimit;\r\n\r\n                opts[\"stroke-linecap\"] = \"round\";\r\n                const dotWidth = 1;\r\n\r\n                opts[\"stroke-linejoin\"] = \"round\";\r\n\r\n                const dashWidth = opts[\"stroke-width\"] * 4;\r\n                const dotSpacing = opts[\"stroke-width\"] * 2;\r\n                switch (pen.style) {\r\n                    case Helper.GDI.PenStyle.PS_DASH:\r\n                        opts[\"stroke-dasharray\"] = [dashWidth, dotSpacing].toString();\r\n                        break;\r\n                    case Helper.GDI.PenStyle.PS_DOT:\r\n                        opts[\"stroke-dasharray\"] = [dotWidth, dotSpacing].toString();\r\n                        break;\r\n                    case Helper.GDI.PenStyle.PS_DASHDOT:\r\n                        opts[\"stroke-dasharray\"] = [dashWidth, dotSpacing, dotWidth, dotSpacing].toString();\r\n                        break;\r\n                    case Helper.GDI.PenStyle.PS_DASHDOTDOT:\r\n                        opts[\"stroke-dasharray\"] =\r\n                            [dashWidth, dotSpacing, dotWidth, dotSpacing, dotWidth, dotSpacing].toString();\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (useBrush) {\r\n            const brush = this.state.selected.brush;\r\n            switch (brush.style) {\r\n                case Helper.GDI.BrushStyle.BS_SOLID:\r\n                    opts.fill = \"#\" + brush.color.toHex();\r\n                    break;\r\n                case Helper.GDI.BrushStyle.BS_PATTERN:\r\n                case Helper.GDI.BrushStyle.BS_DIBPATTERNPT:\r\n                    opts.fill = \"url(#\" + this._getSvgPatternForBrush(brush) + \")\";\r\n                    break;\r\n                case Helper.GDI.BrushStyle.BS_NULL:\r\n                    opts.fill = \"none\";\r\n                    break;\r\n                default:\r\n                    Helper.log(\"[gdi] unsupported brush style: \" + brush.style);\r\n                    opts.fill = \"none\";\r\n                    break;\r\n            }\r\n        }\r\n        if (useFont) {\r\n            const font = this.state.selected.font;\r\n            opts[\"font-family\"] = font.facename;\r\n            opts[\"font-size\"] = Math.abs(font.height);\r\n            opts.fill = \"#\" + this.state.textcolor.toHex();\r\n        }\r\n        return opts;\r\n    }\r\n}\r\n"],"sourceRoot":""}